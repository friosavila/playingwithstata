<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Playing With Stata - DID: The Revolution</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../app_metrics/app_metrics2.html" rel="next">
<link href="../app_metrics/app_metrics3.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-LCL2C8L3JH"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-LCL2C8L3JH', { 'anonymize_ip': true});
</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../WeeMee.jpg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Playing With Stata</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../stataviz/index.html">
 <span class="menu-text">Stata Viz</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../stata_do/index.html">
 <span class="menu-text">Stata Do’s Ado’s</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../app_metrics/index.html" aria-current="page">
 <span class="menu-text">Applied econometrics</span></a>
  </li>  
  <li class="dropdown-header">
 <span class="menu-text">Odds and Ends</span></li>
  <li class="nav-item">
    <a class="nav-link" href="../chatgpt.html">
 <span class="menu-text">Fun with ChatGPT</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">
 <span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../cv.html">
 <span class="menu-text">cv &amp; Papers</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">DID: The Revolution</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../app_metrics/index.html" class="sidebar-item-text sidebar-link">Applied Econometrics</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">App Metrics</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../app_metrics/app_metrics5.html" class="sidebar-item-text sidebar-link">2x2 DID: Sant’Anna and Zhao (2020)</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../app_metrics/app_metrics1.html" class="sidebar-item-text sidebar-link">Constructing synthetic Datasets</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../app_metrics/app_metrics3.html" class="sidebar-item-text sidebar-link">DID: The Fall</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../app_metrics/app_metrics4.html" class="sidebar-item-text sidebar-link active">DID: The Revolution</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../app_metrics/app_metrics2.html" class="sidebar-item-text sidebar-link">DRDID/CSDID in Stata</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#solutions" id="toc-solutions" class="nav-link" data-scroll-target="#solutions">Solutions</a>
  <ul class="collapse">
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#two-steps-did" id="toc-two-steps-did" class="nav-link" data-scroll-target="#two-steps-did">Two-Steps DID</a></li>
  <li><a href="#you-dont-messup-with-ols" id="toc-you-dont-messup-with-ols" class="nav-link" data-scroll-target="#you-dont-messup-with-ols">You don’t messup with OLS</a></li>
  <li><a href="#x2-in-steroids" id="toc-x2-in-steroids" class="nav-link" data-scroll-target="#x2-in-steroids">2x2 in Steroids</a></li>
  </ul></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title d-none d-lg-block">DID: The Revolution</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">How to right the wrongs</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>If you have been keeping up with the advancements and revolution in Difference-in-Differences (DID), you may be aware of the issues associated with using the simple Two-Way Fixed Effects (TWFE) method for identifying treatment effects. If you haven’t, you can refer to my previous post titled <strong>DID: The fall</strong> where I have explained the problem.</p>
<p>The issue can be summarized as follows:</p>
<p>When multiple periods and groups are available, and the treatment has been implemented over several periods, the standard TWFE method is unlikely to identify the average treatment effects. This is because it tends to use inadequate controls, gives negative weights to treated units, and generally suffers from contamination that leads to biased estimates.</p>
<p>As far as I know, the following model can only estimate average treatment effects if treatment effects remain constant over time: <span class="math display">\[
y_{it} = a_i + a_t + \delta D_{it} + e_{it}
\]</span></p>
<p>where <span class="math inline">\(D_{it}=1\)</span> if a unit is effectively treated, <span class="math inline">\(a_i\)</span> represents the unit fixed effects, and <span class="math inline">\(a_t\)</span> time fixed effects.</p>
</section>
<section id="solutions" class="level2">
<h2 class="anchored" data-anchor-id="solutions">Solutions</h2>
<p>Despite the challenges previously discussed, there is still hope for the successful implementation of DID. Numerous scholars have proposed various strategies that specifically address the issues at hand, as hinted in <strong>DID: the Fall.</strong></p>
<p>In this context, I will provide a brief overview of three such solutions, two of which I am actively involved in, and one that is relatively straightforward to comprehend and articulate.</p>
<section id="setup" class="level3">
<h3 class="anchored" data-anchor-id="setup">Setup</h3>
<p>Let us establish some fundamental nomenclature before we delve into the solution. This terminology will help understand and implement the solutions we will cover next.</p>
<p>Before we start discussing the solution, lets stablish some basic nomenclature that may help us understand and implement the solutions we will be discussing later on.</p>
<ol type="1">
<li><p>For simplicity, we will focus on the case of balanced panel data. All units <span class="math inline">\(i\)</span> will be observed for <span class="math inline">\(T\)</span> periods, from <span class="math inline">\(t=1\)</span> to <span class="math inline">\(t=T\)</span>.</p></li>
<li><p>At any given time, individual outcomes are defined as follows: <span class="math display">\[
y_{it} = a_i + a_t + \delta_{it}*D_{it} +e_{it}
\]</span></p></li>
</ol>
<p>where <span class="math inline">\(a_i\)</span> is the individual fixed effect, <span class="math inline">\(a_t\)</span> is a time fixed effect, and <span class="math inline">\(e_{it}\)</span> is an individual level iid error. <span class="math inline">\(D_{it}\)</span> is a dummy variable that takes the value of 1 after a unit is treated.</p>
<p>Notice that here, the treatment effect fully heterogeneous.</p>
<ol start="3" type="1">
<li><p>Once a unit has been treated, it remains so, even if the effect eventually fades away. (if <span class="math inline">\(D_{it}=1 \rightarrow D_{is}=1 \ \forall \ s&gt;t\)</span>)</p></li>
<li><p>There is variation in treatment timing, and as a result, the treatment dummy is not activated for everyone at the same time.</p></li>
<li><p>Assume there are no controls.</p></li>
</ol>
<p>Under this conditions, lets simulate a simple dataset with this characteristics:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">clear</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">linesize</span> 250</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="dv">seed</span>     111</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> sortseed 111</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">set</span> <span class="kw">obs</span> 100  <span class="co">// &lt;- 100 units</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> id = <span class="dt">_n</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> ai = rchi2(2)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">// determines When would units receive treatment</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span>     g = runiformint(2,10)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="kw">replace</span> g = 0 <span class="kw">if</span> g&gt;9   <span class="co">// never treated       </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>expand 10   <span class="co">// &lt;-T=10</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> id:<span class="kw">gen</span> t=<span class="dt">_n</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> event = <span class="fu">max</span>(0,t-g)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> aux = runiform()*2</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="kw">bysort</span> t:<span class="kw">gen</span> <span class="fu">at</span> = aux[1] <span class="co">// Determines Time fixed effect</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="kw">te</span> = (1-g/10)+(1-event/10)  </span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">// Treatment effect but vanishes with time</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> eit= rnormal()</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> trt  = (t&gt;=g)*(g&gt;0)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> teff = <span class="kw">te</span> * trt </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> <span class="fu">y</span> = ai + <span class="fu">at</span> + <span class="kw">te</span> * trt + eit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of observations (_N) was 0, now 100.
(18 real changes made)
(900 observations created)</code></pre>
</div>
</div>
<p>The simulated data will follow 100 units over a span of 10 periods. Each unit is assigned to receive treatment at some point between periods 2 and 9, while 1/10 of the sample is not treated at all.</p>
<p>The impact of the treatment depends on two factors: the timing of treatment and the duration of treatment. The treatment effect becomes smaller the later a unit is treated, and as a unit is treated for longer durations.</p>
</section>
<section id="two-steps-did" class="level3">
<h3 class="anchored" data-anchor-id="two-steps-did">Two-Steps DID</h3>
<section id="gardner_two-stage_2022-did2s-borusyak_revisiting_2022-did_imputation" class="level4">
<h4 class="anchored" data-anchor-id="gardner_two-stage_2022-did2s-borusyak_revisiting_2022-did_imputation"><span class="citation" data-cites="gardner_two-stage_2022">Gardner (<a href="#ref-gardner_two-stage_2022" role="doc-biblioref">2022</a>)</span> <code>did2s</code> &amp; <span class="citation" data-cites="borusyak_revisiting_2022">Borusyak, Jaravel, and Spiess (<a href="#ref-borusyak_revisiting_2022" role="doc-biblioref">2022</a>)</span> <code>did_imputation</code></h4>
<p>Let’s start by desribing one of the solutions solutions: the two-step DID, also referred to as the imputation approach. This strategy is explained and explored by two notable papers: <span class="citation" data-cites="gardner_two-stage_2022">Gardner (<a href="#ref-gardner_two-stage_2022" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="borusyak_revisiting_2022">Borusyak, Jaravel, and Spiess (<a href="#ref-borusyak_revisiting_2022" role="doc-biblioref">2022</a>)</span>.</p>
<p>As the name implies, this approach aims to estimate treatment effects in a design with multiple groups treated at various points in time by imputing the values of what would have occurred to those units if they were never subjected to treatment. To accomplish this, the authors suggest breaking down the identification problem into two steps to avoid the erroneous use of already treated units as controls.</p>
<p>In the first step, one should only use units that have never been treated or have not yet been treated to model potential outcomes under the no-treatment scenario.</p>
<p><span class="math display">\[
y_{it} = a_i + a_t + e_{it} \ if \ t&lt;g
\]</span></p>
<p>Doing this, the fixed effects <span class="math inline">\(a_i\)</span> and <span class="math inline">\(a_t\)</span> would not be contaminated by the treatment, because non of the units in the sample are treated.</p>
<p>In the second step, individual-level treatment effects predictions can be obtained by simply computing the difference between the observed outcome under treatment and the prediction of the first step (<span class="math inline">\(\hat y_{it} = \hat a_i + \hat a _t\)</span>), which represent the potential outcomes of those units if no treatment occured.</p>
<p><span class="math display">\[
\delta_{it} = y_{it}-\hat a_i - \hat a_t
\]</span></p>
<p>Because unit level treatment effects are not useful for statistical inference, one can use aggregations to obtain standard errors or aggregates we are more familiar with: Average treatment effect on treated, dynamic effects, etc.</p>
<p>To correctly estimate standard errors, both steps should be estimated simulatenously, so that the estimation error from the first stage can propagate to the second stage. While you can use <code>did2s</code> or <code>did_imputation</code>, I will show you the code using <code>gmm</code>, so you can see how the whole system would work.</p>
<p>In the following code line (1) identifies the individual and time FE using only notyet treated units (trt=0). Line 2 uses tha to substract from <span class="math inline">\(y\)</span> and identify the treatment effect (ATT). Lines 3 and 4 provides information to gmm to estimate the model and standard errors:</p>
<div class="cell" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>gmm ((<span class="fu">y</span>-{a0}-{a_i:i.g}-{a_t:i.t})*(trt==0))     <span class="co">/// </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    ((<span class="fu">y</span>-{a0}-{a_i:}   -{a_t:}    -{att:trt})) , <span class="co">/// </span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    winitial(<span class="kw">identity</span>)  instruments(1:i.g i.t) instruments(2: trt) <span class="co">/// </span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    onestep quickderivatives <span class="kw">vce</span>(<span class="kw">cluster</span> i)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Step 1</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration 0:   GMM criterion Q(b) =  19.725543  </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration 1:   GMM criterion Q(b) =  5.816e-23  </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Iteration 2:   GMM criterion Q(b) =  9.081e-33  </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
GMM estimation 

Number of parameters =  19
Number of moments    =  20
Initial weight matrix: Identity                   Number of obs   =      1,000
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                                   (Std. err. adjusted for 100 clusters in id)
------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             |               Robust</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             | Coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------+----------------------------------------------------------------
a0           |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>       _cons |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   3.146414   .6822892     4.61   0.000     1.809152    4.483677
-------------+----------------------------------------------------------------
a_i          |
           g |
          2  |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>  -1.329894   .9540798    -1.39   0.163    -3.199856    .5400685
          3  |   .3303121   .9832247     0.34   0.737    -1.596773    2.257397
          4  |  -.9533545   .8233816    -1.16   0.247    -2.567153    .6604439
          5  |  -.9570973   .8366389    -1.14   0.253    -2.596879    .6826848
          6  |    -.58129   .8707363    -0.67   0.504    -2.287902    1.125322
          7  |   .9916895   1.010794     0.98   0.327    -.9894297    2.972809
          8  |  -1.609291   .7437976    -2.16   0.030    -3.067108   -.1514746
          9  |  -1.160353   1.033179    -1.12   0.261    -3.185346    .8646411
-------------+----------------------------------------------------------------
a_t          |
           t |
          2  |  -.0585438   .1385197    -0.42   0.673    -.3300374    .2129498
          3  |   -.213678   .1704212    -1.25   0.210    -.5476975    .1203415
          4  |  -.5752045   .1713895    -3.36   0.001    -.9111217   -.2392872
          5  |   .0842171   .1677747     0.50   0.616    -.2446152    .4130494
          6  |   .1190078   .1841714     0.65   0.518    -.2419615    .4799771
          7  |   1.000738   .2034229     4.92   0.000     .6020363    1.399439
          8  |  -.0146057   .2190799    -0.07   0.947    -.4439945    .4147831
          9  |   .9380065   .2007013     4.67   0.000     .5446391    1.331374
         10  |   .9572597   .2578496     3.71   0.000     .4518838    1.462636
-------------+----------------------------------------------------------------
att          |
         trt |   1.458058   .1493165     9.76   0.000     1.165403    1.750713
------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Instruments for equation 1: 0b.g 2.g 3.g 4.g 5.g 6.g 7.g 8.g 9.g 1b.t 2.t 3.t 4.t 5.t 6.t 7.t 8.t 9.t 10.t _cons
Instruments for equation 2: trt _cons</code></pre>
</div>
</div>
<p>You can compare this to the true effect:</p>
<div class="cell" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sum</span> teff <span class="kw">if</span> trt==1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Variable |        Obs        Mean    Std. dev.       Min        Max
-------------+---------------------------------------------------------
        teff |        472    1.280297    .2217799          1        1.8</code></pre>
</div>
</div>
<p>One advantage of this approach is that you could model the second stage to allow other types of aggregations:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> g0=g*trt    </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="kw">gen</span> t0=t*trt</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>gmm ((<span class="fu">y</span>-{a0}-{a_i:i.g}-{a_t:i.t})*(trt==0)) <span class="co">///</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    ((<span class="fu">y</span>-{a0}-{a_i:}   -{a_t:}    -{att:i.g0})) , <span class="co">///</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    winitial(<span class="kw">identity</span>)  instruments(1:i.g i.t) instruments(1: i.g0) <span class="co">///</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    onestep quickderivatives <span class="kw">vce</span>(<span class="kw">cluster</span> i) </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>gmm ((<span class="fu">y</span>-{a0}-{a_i:i.g}-{a_t:i.t})*(trt==0)) <span class="co">///</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    ((<span class="fu">y</span>-{a0}-{a_i:}   -{a_t:}    -{att:i.t0})) , <span class="co">///</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    winitial(<span class="kw">identity</span>)  instruments(1:i.g i.t) instruments(2: i.t0) <span class="co">///</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    onestep quickderivatives <span class="kw">vce</span>(<span class="kw">cluster</span> i)             </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="you-dont-messup-with-ols" class="level3">
<h3 class="anchored" data-anchor-id="you-dont-messup-with-ols">You don’t messup with OLS</h3>
<section id="wooldridge_twoway_2021-jwdid-and-sun_estimating_2021" class="level4">
<h4 class="anchored" data-anchor-id="wooldridge_twoway_2021-jwdid-and-sun_estimating_2021"><span class="citation" data-cites="wooldridge_twoway_2021">Wooldridge (<a href="#ref-wooldridge_twoway_2021" role="doc-biblioref">2021</a>)</span> <code>jwdid</code> and <span class="citation" data-cites="sun_estimating_2021">Sun and Abraham (<a href="#ref-sun_estimating_2021" role="doc-biblioref">2021</a>)</span></h4>
<p>In the article <strong>DID: the fall</strong>, it was pointed out that the conventional TWFE approach has faced significant backlash due to its limited ability to detect treatment effects, because it cannot distinguish between good and bad variation when estimating treatment effects. Despite this criticism, Professor Wooldridge came in defense and revitalized the approach by emphasizing its simplicity and versatility, enabling extensions to go beyond linear models.</p>
<p>The message was simple:</p>
<blockquote class="blockquote">
<p>Although the conventional TWFE method has several shortcomings, if it is implemented correctly, it can overcome the issue of utilizing inadequate controls in estimation. As a result, it can estimate treatment effects efficiently, with results similar to <span class="citation" data-cites="borusyak_revisiting_2022">Borusyak, Jaravel, and Spiess (<a href="#ref-borusyak_revisiting_2022" role="doc-biblioref">2022</a>)</span> and <span class="citation" data-cites="gardner_two-stage_2022">Gardner (<a href="#ref-gardner_two-stage_2022" role="doc-biblioref">2022</a>)</span>.</p>
</blockquote>
<p>So what were we missing? Heterogeneity!</p>
<p>Both <span class="citation" data-cites="wooldridge_twoway_2021">Wooldridge (<a href="#ref-wooldridge_twoway_2021" role="doc-biblioref">2021</a>)</span> and <span class="citation" data-cites="sun_estimating_2021">Sun and Abraham (<a href="#ref-sun_estimating_2021" role="doc-biblioref">2021</a>)</span> have proposed similar solutions to the problem at hand, albeit from different viewpoints. <span class="citation" data-cites="sun_estimating_2021">Sun and Abraham (<a href="#ref-sun_estimating_2021" role="doc-biblioref">2021</a>)</span> argued that utilizing event studies with leads and lags may lead to contaminated coefficients, thus hampering proper identification of dynamic treatment effects. As a potential solution, the authors suggests using a specification that estimates dynamic effects for each cohort before making aggregations.</p>
<p>On the other hand, <span class="citation" data-cites="wooldridge_twoway_2021">Wooldridge (<a href="#ref-wooldridge_twoway_2021" role="doc-biblioref">2021</a>)</span> focused on identifying treatment effects. He recommends allowing all treatment effects to vary by cohort and time. In other words, instead of employing a single dummy variable to identify treated units, he suggests using a set of dummies representing the interaction of cohorts and periods.</p>
<p>Specifically, <span class="citation" data-cites="wooldridge_twoway_2021">Wooldridge (<a href="#ref-wooldridge_twoway_2021" role="doc-biblioref">2021</a>)</span> proposes estimating a model with the following specification:</p>
<p><span class="math display">\[
y_{it} = a_i + a_t + \sum_{g=g_0}^G \sum_{t=g}^T \delta_{gt} * 1(g,t)+e_{it}
\]</span></p>
<p>What Wooldridge suggests, at least for the case without covariates, is to estimate a model where, in addition to the individual (or cohort) and time fixed effects, we saturate <strong>all</strong> possible combinations of cohorts and times (<span class="math inline">\(1(g,t)\)</span>), if that combination corresponds to an effectively treated unit (<span class="math inline">\(t\geq g\)</span>). This specification essentially uses all not-yet treated units as controls, similar to the two-step approach.</p>
<p>This specification, however, could also be extended to a case where only those never treated are used as controls. In this case, one should use all cohort and time interactions, including the cases before units were treated. Following convention, one should exclude from the list of interactions the period before treatment took place:</p>
<p><span class="math display">\[
y_{it} = a_i + a_t + \sum_{g=g_0}^G \sum_{t\neq g-1} \delta_{gt} * 1(g,t)+e_{it}
\]</span></p>
<p>By saturating the model this way, each <span class="math inline">\(\delta_{gt}\)</span> represents a treatment effect for group G at time T, which can be later aggregated to obtain dynamic, group, or average treatment effects. Also interesting to note that this second specification is essentially the same <span class="citation" data-cites="sun_estimating_2021">Sun and Abraham (<a href="#ref-sun_estimating_2021" role="doc-biblioref">2021</a>)</span> propose for dynamic effects, and produces results that are identical to the methodology proposed by <span class="citation" data-cites="callaway_santanna_2021">Callaway and Sant’Anna (<a href="#ref-callaway_santanna_2021" role="doc-biblioref">2021</a>)</span>.</p>
<p>Now for the application, I will use <code>jwdid</code> for both specifications. Because by default <code>jwdid</code> produces the fully saturated model, I will omit those results, showing only the average treatment effect.</p>
<p>First the one using not-yet treated units as controls (default), which produces exactly the same results as the two-step approach:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">ssc</span> install jwdid</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: jwdid <span class="fu">y</span>, ivar(i) tvar(t) gvar(g)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> simple</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>checking jwdid consistency and verifying not already installed...</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>all files already exist and are up to date.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING: Singleton observations not dropped; statistical significance is biased (link)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             |            Delta-method</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>             | Coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>-------------+----------------------------------------------------------------
         _at |
   (2 vs 1)  |</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   1.458058   .1494798     9.75   0.000     1.165083    1.751033</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>Second the one with never treated units as controls:</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: jwdid <span class="fu">y</span>, ivar(i) tvar(t) gvar(g) never</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> simple</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>WARNING: Singleton observations not dropped; statistical significance is biased (link)</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>------------------------------------------------------------------------------
             |            Delta-method
             | Coefficient  std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         _at |
   (2 vs 1)  |   1.543749   .1567784     9.85   0.000     1.236469    1.851029
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
</section>
<section id="x2-in-steroids" class="level3">
<h3 class="anchored" data-anchor-id="x2-in-steroids">2x2 in Steroids</h3>
<section id="callaway_santanna_2021-csdid-csdid2" class="level4">
<h4 class="anchored" data-anchor-id="callaway_santanna_2021-csdid-csdid2"><span class="citation" data-cites="callaway_santanna_2021">Callaway and Sant’Anna (<a href="#ref-callaway_santanna_2021" role="doc-biblioref">2021</a>)</span> <code>csdid</code> &amp; <code>csdid2</code></h4>
<p>The third option is the most computing intensive, but at the same time simpler to understand, if you break it down to the basics. This is why I call this 2x2 in Steroids: <span class="citation" data-cites="callaway_santanna_2021">Callaway and Sant’Anna (<a href="#ref-callaway_santanna_2021" role="doc-biblioref">2021</a>)</span>.</p>
<p>The literature on the 2x2 DID design has been extensively explored and extended, and it appears that most of the criticisms of the TWFE method do not apply to this simple design. Although there are a few technical details to consider while estimating ATT’s, most of the information required can be found in <span class="citation" data-cites="santanna_doubly_2020">Sant’Anna and Zhao (<a href="#ref-santanna_doubly_2020" role="doc-biblioref">2020</a>)</span>. In this work, the authors provide several options for obtaining the best estimate from a simple 2x2 DID design.</p>
<p>Assuming that we know how to execute 2x2 DID correctly (which can be achieved using <code>drdid</code> in Stata), <span class="citation" data-cites="callaway_santanna_2021">Callaway and Sant’Anna (<a href="#ref-callaway_santanna_2021" role="doc-biblioref">2021</a>)</span> propose that we focus on estimating all the good and useful 2x2 DID designs from our data while avoiding incorrect comparisons. These are the building blocks of the methodology, the ATTGTs. This are the average treatment effects on the treated for units treated for the first time in period G, but measured at period T.</p>
<p>This process, however, could be time-consuming and computationally intensive if done manually, as the number of 2x2 designs increases with the number of cohorts and periods available in the data. For example, estimating 50 different ATTs would be necessary with 5 cohorts and 10 periods, and up to 5 separate models need to be estimated for each ATT.</p>
<p>Borrowing from the nomenclature in <span class="citation" data-cites="callaway_santanna_2021">Callaway and Sant’Anna (<a href="#ref-callaway_santanna_2021" role="doc-biblioref">2021</a>)</span>, this ATTGT’s are defined as follows: <span class="math display">\[
\begin{aligned}
    ATT(g,t) &amp;= E(Y_{i,t}|i\in g) - E(Y_{i,g-1}|i\in g) \\
             &amp; -\Big[ E(Y_{i,t}|i\in C) - E(Y_{i,g-1}|i\in C) \Big]
\end{aligned}
\]</span></p>
<p>Which has the same structure as the simple 2x2 DID, with the difference that the control group <span class="math inline">\(C\)</span> will be formed by never treated units only, or include those not yet treated ( <span class="math inline">\(i \in g_i, g_i&gt;t, \And \  g_i&gt;g\)</span>).<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
<p>Once all individual ATTGT’s have been identified and estimated, providing summary measures we are more familiar with is as easy as obtaining weighted averages:</p>
<p><span class="math display">\[
SATT = \sum \left( \frac{w_{gt} }{\sum w_{gt}}ATT(g,t) \right)
\]</span></p>
<p>where the weights <span class="math inline">\(w_{gt}\)</span> will change based on the type of aggregation one is interested in.</p>
<p>This multiple stage process may seem challening, but there are tools that allow you to implement them quite easily: <code>csdid</code> and <code>csdid2</code>. The first one, was written as a wrapper around <code>drdid</code>, to do all the heavy lifting for you. However, for large projects, it can be slow due to overhead. The alternative <code>csdid2</code> is self contained, still under development, but much faster than the predecesor. See <a href="https://github.com/friosavila/csdid2"><code>csdid2</code></a> if interested. Here I will use <code>csdid</code>, which you can get from SSC.</p>
<p>As with <code>jwdid</code>. The default option is for <code>csdid</code> to produce all ATTGT’s. So, for the excercise, I’ll omit that ouput, and estimate the aggregate effects with the post estimation command. The default is to use the never treated as controls. I will also add the option <code>long2</code> to obtain the pre-treatment ATTGT’s as describe above, even though they won’t affect our point estimates:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">ssc</span> install drdid, <span class="kw">replace</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: <span class="kw">ssc</span> install csdid, <span class="kw">replace</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: csdid <span class="fu">y</span>, ivar(i) time(t) gvar(g) long2</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> simple </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Treatment Effect on Treated
------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         ATT |   1.543749   .1577366     9.79   0.000     1.234591    1.852907
------------------------------------------------------------------------------</code></pre>
</div>
</div>
<p>I will also use the not yet treated, to compare results.</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode stata code-with-copy"><code class="sourceCode stata"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">qui</span>: csdid <span class="fu">y</span>, ivar(i) time(t) gvar(g) notyet long2</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">estat</span> simple </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Treatment Effect on Treated
------------------------------------------------------------------------------
             | Coefficient  Std. err.      z    P&gt;|z|     [95% conf. interval]
-------------+----------------------------------------------------------------
         ATT |   1.494475   .1587386     9.41   0.000     1.183353    1.805597
------------------------------------------------------------------------------</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>On this occasion, I have shared with you three solutions from the literature that aim to overcome the limitations of TWFE. Although there are other solutions available, I personally find these three to be the most intuitive and have worked on them. Granted, I have some bias on the matter.</p>
<p>Despite their apparent differences, these solutions actually converge towards similar outcomes, with discrepancies arising from variations in assumptions regarding control groups or covariate management.</p>
<table class="table">
<thead>
<tr class="header">
<th>command</th>
<th>eq command</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>jwdid</code></td>
<td><code>did2s</code> &amp; <code>did_imputation</code></td>
</tr>
<tr class="even">
<td><code>jwdid, never</code></td>
<td><code>eventstudyinteract</code></td>
</tr>
<tr class="odd">
<td><code>jwdid, never</code></td>
<td><code>csdid, long2</code> or <code>csdid2, long</code></td>
</tr>
</tbody>
</table>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-borusyak_revisiting_2022" class="csl-entry" role="doc-biblioentry">
Borusyak, Kirill, Xavier Jaravel, and Jann Spiess. 2022. <span>“Revisiting <span>Event</span> <span>Study</span> <span>Designs</span>: <span>Robust</span> and <span>Efficient</span> <span>Estimation</span>.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2108.12419">https://doi.org/10.48550/arXiv.2108.12419</a>.
</div>
<div id="ref-callaway_santanna_2021" class="csl-entry" role="doc-biblioentry">
Callaway, Brantly, and Pedro H. C. Sant’Anna. 2021. <span>“Difference-in-<span>Differences</span> with Multiple Time Periods.”</span> <em>Journal of Econometrics</em>, Themed <span>Issue</span>: <span>Treatment</span> <span>Effect</span> 1, 225 (2): 200–230. <a href="https://doi.org/10.1016/j.jeconom.2020.12.001">https://doi.org/10.1016/j.jeconom.2020.12.001</a>.
</div>
<div id="ref-gardner_two-stage_2022" class="csl-entry" role="doc-biblioentry">
Gardner, John. 2022. <span>“Two-Stage Differences in Differences.”</span> arXiv. <a href="https://doi.org/10.48550/arXiv.2207.05943">https://doi.org/10.48550/arXiv.2207.05943</a>.
</div>
<div id="ref-santanna_doubly_2020" class="csl-entry" role="doc-biblioentry">
Sant’Anna, Pedro H. C., and Jun Zhao. 2020. <span>“Doubly Robust Difference-in-Differences Estimators.”</span> <em>Journal of Econometrics</em> 219 (1): 101–22. <a href="https://doi.org/10.1016/j.jeconom.2020.06.003">https://doi.org/10.1016/j.jeconom.2020.06.003</a>.
</div>
<div id="ref-sun_estimating_2021" class="csl-entry" role="doc-biblioentry">
Sun, Liyang, and Sarah Abraham. 2021. <span>“Estimating Dynamic Treatment Effects in Event Studies with Heterogeneous Treatment Effects.”</span> <em>Journal of Econometrics</em>, Themed <span>Issue</span>: <span>Treatment</span> <span>Effect</span> 1, 225 (2): 175–99. <a href="https://doi.org/10.1016/j.jeconom.2020.09.006">https://doi.org/10.1016/j.jeconom.2020.09.006</a>.
</div>
<div id="ref-wooldridge_twoway_2021" class="csl-entry" role="doc-biblioentry">
Wooldridge, Jeffrey M. 2021. <span>“Two-<span>Way</span> <span>Fixed</span> <span>Effects</span>, the <span>Two</span>-<span>Way</span> <span>Mundlak</span> <span>Regression</span>, and <span>Difference</span>-in-<span>Differences</span> <span>Estimators</span>.”</span> {SSRN} {Scholarly} {Paper}. Rochester, NY. <a href="https://doi.org/10.2139/ssrn.3906345">https://doi.org/10.2139/ssrn.3906345</a>.
</div>
</div>


<!-- -->

</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>There are two other options, but I will leave them for a different post<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../app_metrics/app_metrics3.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">DID: The Fall</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../app_metrics/app_metrics2.html" class="pagination-link">
        <span class="nav-page-text">DRDID/CSDID in Stata</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb37" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "DID: The Revolution"</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "How to right the wrongs"</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="fu">## Introduction</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>If you have been keeping up with the advancements and revolution in Difference-in-Differences (DID), you may be aware of the issues associated with using the simple Two-Way Fixed Effects (TWFE) method for identifying treatment effects. If you haven't, you can refer to my previous post titled **DID: The fall** where I have explained the problem.</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>The issue can be summarized as follows:</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>When multiple periods and groups are available, and the treatment has been implemented over several periods, the standard TWFE method is unlikely to identify the average treatment effects. This is because it tends to use inadequate controls, gives negative weights to treated units, and generally suffers from contamination that leads to biased estimates.</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>As far as I know, the following model can only estimate average treatment effects if treatment effects remain constant over time:</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>y_{it} = a_i + a_t + \delta D_{it} + e_{it}</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>where $D_{it}=1$ if a unit is effectively treated, $a_i$ represents the unit fixed effects, and $a_t$ time fixed effects.</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a><span class="fu">## Solutions</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>Despite the challenges previously discussed, there is still hope for the successful implementation of DID. Numerous scholars have proposed various strategies that specifically address the issues at hand, as hinted in **DID: the Fall.**</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>In this context, I will provide a brief overview of three such solutions, two of which I am actively involved in, and one that is relatively straightforward to comprehend and articulate.</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a><span class="fu">### Setup</span></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>Let us establish some fundamental nomenclature before we delve into the solution. This terminology will help understand and implement the solutions we will cover next.</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>Before we start discussing the solution, lets stablish some basic nomenclature that may help us understand and implement the solutions we will be discussing later on.</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>For simplicity,  we will focus on the case of balanced panel data. All units $i$ will be observed for $T$ periods, from $t=1$ to $t=T$.</span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>At any given time, individual outcomes are defined as follows:</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a>y_{it} = a_i + a_t + \delta_{it}*D_{it} +e_{it}</span>
<span id="cb37-39"><a href="#cb37-39" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-40"><a href="#cb37-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-41"><a href="#cb37-41" aria-hidden="true" tabindex="-1"></a>where $a_i$ is the individual fixed effect, $a_t$ is a time fixed effect, and $e_{it}$ is an individual level iid error. </span>
<span id="cb37-42"><a href="#cb37-42" aria-hidden="true" tabindex="-1"></a>$D_{it}$ is a dummy variable that takes the value of 1 after a unit is treated. </span>
<span id="cb37-43"><a href="#cb37-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-44"><a href="#cb37-44" aria-hidden="true" tabindex="-1"></a>Notice that here, the treatment effect fully heterogeneous. </span>
<span id="cb37-45"><a href="#cb37-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-46"><a href="#cb37-46" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Once a unit has been treated, it remains so, even if the effect eventually fades away. (if $D_{it}=1 \rightarrow D_{is}=1 \ \forall \ s&gt;t$)</span>
<span id="cb37-47"><a href="#cb37-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-48"><a href="#cb37-48" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>There is variation in treatment timing, and as a result, the treatment dummy is not activated for everyone at the same time.</span>
<span id="cb37-49"><a href="#cb37-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-50"><a href="#cb37-50" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>Assume there are no controls.</span>
<span id="cb37-51"><a href="#cb37-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-52"><a href="#cb37-52" aria-hidden="true" tabindex="-1"></a>Under this conditions, lets simulate a simple dataset with this characteristics:</span>
<span id="cb37-53"><a href="#cb37-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-56"><a href="#cb37-56" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb37-57"><a href="#cb37-57" aria-hidden="true" tabindex="-1"></a><span class="in">*| code-fold: false</span></span>
<span id="cb37-58"><a href="#cb37-58" aria-hidden="true" tabindex="-1"></a><span class="in">clear</span></span>
<span id="cb37-59"><a href="#cb37-59" aria-hidden="true" tabindex="-1"></a><span class="in">set linesize 250</span></span>
<span id="cb37-60"><a href="#cb37-60" aria-hidden="true" tabindex="-1"></a><span class="in">set seed     111</span></span>
<span id="cb37-61"><a href="#cb37-61" aria-hidden="true" tabindex="-1"></a><span class="in">set sortseed 111</span></span>
<span id="cb37-62"><a href="#cb37-62" aria-hidden="true" tabindex="-1"></a><span class="in">set obs 100  // &lt;- 100 units</span></span>
<span id="cb37-63"><a href="#cb37-63" aria-hidden="true" tabindex="-1"></a><span class="in">gen id = _n</span></span>
<span id="cb37-64"><a href="#cb37-64" aria-hidden="true" tabindex="-1"></a><span class="in">gen ai = rchi2(2)</span></span>
<span id="cb37-65"><a href="#cb37-65" aria-hidden="true" tabindex="-1"></a><span class="in">// determines When would units receive treatment</span></span>
<span id="cb37-66"><a href="#cb37-66" aria-hidden="true" tabindex="-1"></a><span class="in">gen     g = runiformint(2,10)</span></span>
<span id="cb37-67"><a href="#cb37-67" aria-hidden="true" tabindex="-1"></a><span class="in">replace g = 0 if g&gt;9   // never treated       </span></span>
<span id="cb37-68"><a href="#cb37-68" aria-hidden="true" tabindex="-1"></a><span class="in">expand 10   // &lt;-T=10</span></span>
<span id="cb37-69"><a href="#cb37-69" aria-hidden="true" tabindex="-1"></a><span class="in">bysort id:gen t=_n </span></span>
<span id="cb37-70"><a href="#cb37-70" aria-hidden="true" tabindex="-1"></a><span class="in">gen event = max(0,t-g)</span></span>
<span id="cb37-71"><a href="#cb37-71" aria-hidden="true" tabindex="-1"></a><span class="in">gen aux = runiform()*2</span></span>
<span id="cb37-72"><a href="#cb37-72" aria-hidden="true" tabindex="-1"></a><span class="in">bysort t:gen at = aux[1] // Determines Time fixed effect</span></span>
<span id="cb37-73"><a href="#cb37-73" aria-hidden="true" tabindex="-1"></a><span class="in">gen te = (1-g/10)+(1-event/10)  </span></span>
<span id="cb37-74"><a href="#cb37-74" aria-hidden="true" tabindex="-1"></a><span class="in">// Treatment effect but vanishes with time</span></span>
<span id="cb37-75"><a href="#cb37-75" aria-hidden="true" tabindex="-1"></a><span class="in">gen eit= rnormal()</span></span>
<span id="cb37-76"><a href="#cb37-76" aria-hidden="true" tabindex="-1"></a><span class="in">gen trt  = (t&gt;=g)*(g&gt;0)</span></span>
<span id="cb37-77"><a href="#cb37-77" aria-hidden="true" tabindex="-1"></a><span class="in">gen teff = te * trt </span></span>
<span id="cb37-78"><a href="#cb37-78" aria-hidden="true" tabindex="-1"></a><span class="in">gen y = ai + at + te * trt + eit</span></span>
<span id="cb37-79"><a href="#cb37-79" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-80"><a href="#cb37-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-81"><a href="#cb37-81" aria-hidden="true" tabindex="-1"></a>The simulated data will follow 100 units over a span of 10 periods. Each unit is assigned to receive treatment at some point between periods 2 and 9, while 1/10 of the sample is not treated at all.</span>
<span id="cb37-82"><a href="#cb37-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-83"><a href="#cb37-83" aria-hidden="true" tabindex="-1"></a>The impact of the treatment depends on two factors: the timing of treatment and the duration of treatment. The treatment effect becomes smaller the later a unit is treated, and as a unit is treated for longer durations.</span>
<span id="cb37-84"><a href="#cb37-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-85"><a href="#cb37-85" aria-hidden="true" tabindex="-1"></a><span class="fu">### Two-Steps DID</span></span>
<span id="cb37-86"><a href="#cb37-86" aria-hidden="true" tabindex="-1"></a><span class="fu">#### @gardner_two-stage_2022 `did2s` &amp;  @borusyak_revisiting_2022 `did_imputation`</span></span>
<span id="cb37-87"><a href="#cb37-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-88"><a href="#cb37-88" aria-hidden="true" tabindex="-1"></a>Let's start by desribing one of the solutions solutions: the two-step DID, also referred to as the imputation approach. This strategy is explained and explored by two notable papers: @gardner_two-stage_2022 and @borusyak_revisiting_2022.</span>
<span id="cb37-89"><a href="#cb37-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-90"><a href="#cb37-90" aria-hidden="true" tabindex="-1"></a>As the name implies, this approach aims to estimate treatment effects in a design with multiple groups treated at various points in time by imputing the values of what would have occurred to those units if they were never subjected to treatment. To accomplish this, the authors suggest breaking down the identification problem into two steps to avoid the erroneous use of already treated units as controls.</span>
<span id="cb37-91"><a href="#cb37-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-92"><a href="#cb37-92" aria-hidden="true" tabindex="-1"></a>In the first step, one should only use units that have never been treated or have not yet been treated to model potential outcomes under the no-treatment scenario.</span>
<span id="cb37-93"><a href="#cb37-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-94"><a href="#cb37-94" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-95"><a href="#cb37-95" aria-hidden="true" tabindex="-1"></a>y_{it} = a_i + a_t + e_{it} \ if \ t<span class="kw">&lt;g</span></span>
<span id="cb37-96"><a href="#cb37-96" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb37-97"><a href="#cb37-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-98"><a href="#cb37-98" aria-hidden="true" tabindex="-1"></a><span class="ot">Doing</span> <span class="er">this,</span> <span class="er">the</span> <span class="er">fixed</span> <span class="er">effects</span> <span class="er">$a_i$</span> <span class="er">and</span> <span class="er">$a_t$</span> <span class="er">would</span> <span class="er">not</span> <span class="er">be</span> <span class="er">contaminated</span> <span class="er">by</span> <span class="er">the</span> <span class="er">treatment,</span> <span class="er">because</span> <span class="er">non</span> <span class="er">of</span> <span class="er">the</span> <span class="er">units</span> <span class="er">in</span> <span class="er">the</span> <span class="er">sample</span> <span class="er">are</span> <span class="er">treated.</span> </span>
<span id="cb37-99"><a href="#cb37-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-100"><a href="#cb37-100" aria-hidden="true" tabindex="-1"></a><span class="ot">In</span> <span class="er">the</span> <span class="er">second</span> <span class="er">step,</span> <span class="er">individual-level</span> <span class="er">treatment</span> <span class="er">effects</span> <span class="er">predictions</span> <span class="er">can</span> <span class="er">be</span> <span class="er">obtained</span> <span class="er">by</span> <span class="er">simply</span> <span class="er">computing</span> <span class="er">the</span> <span class="er">difference</span> <span class="er">between</span> <span class="er">the</span> <span class="er">observed</span> <span class="er">outcome</span> <span class="er">under</span> <span class="er">treatment</span> <span class="er">and</span> <span class="er">the</span> <span class="er">prediction</span> <span class="er">of</span> <span class="er">the</span>  <span class="er">first</span> <span class="er">step</span> <span class="er">($\hat</span> <span class="er">y_{it}</span> <span class="ot">=</span> <span class="st">\hat</span> <span class="er">a_i</span> <span class="er">+</span> <span class="er">\hat</span> <span class="er">a</span> <span class="er">_t$),</span> <span class="er">which</span> <span class="er">represent</span> <span class="er">the</span> <span class="er">potential</span> <span class="er">outcomes</span> <span class="er">of</span> <span class="er">those</span> <span class="er">units</span> <span class="er">if</span> <span class="er">no</span> <span class="er">treatment</span> <span class="er">occured.</span></span>
<span id="cb37-101"><a href="#cb37-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-102"><a href="#cb37-102" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb37-103"><a href="#cb37-103" aria-hidden="true" tabindex="-1"></a><span class="er">\delta_{it}</span> <span class="ot">=</span> <span class="st">y_{it}-\hat</span> <span class="er">a_i</span> <span class="er">-</span> <span class="er">\hat</span> <span class="er">a_t</span></span>
<span id="cb37-104"><a href="#cb37-104" aria-hidden="true" tabindex="-1"></a><span class="er">$$</span></span>
<span id="cb37-105"><a href="#cb37-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-106"><a href="#cb37-106" aria-hidden="true" tabindex="-1"></a><span class="ot">Because</span> <span class="er">unit</span> <span class="er">level</span> <span class="er">treatment</span> <span class="er">effects</span> <span class="er">are</span> <span class="er">not</span> <span class="er">useful</span> <span class="er">for</span> <span class="er">statistical</span> <span class="er">inference,</span> <span class="er">one</span> <span class="er">can</span> <span class="er">use</span> <span class="er">aggregations</span> <span class="er">to</span> <span class="er">obtain</span> <span class="er">standard</span> <span class="er">errors</span> <span class="er">or</span> <span class="er">aggregates</span> <span class="er">we</span> <span class="er">are</span> <span class="er">more</span> <span class="er">familiar</span> <span class="er">with:</span> <span class="er">Average</span> <span class="er">treatment</span> <span class="er">effect</span> <span class="er">on</span> <span class="er">treated,</span> <span class="er">dynamic</span> <span class="er">effects,</span> <span class="er">etc.</span></span>
<span id="cb37-107"><a href="#cb37-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-108"><a href="#cb37-108" aria-hidden="true" tabindex="-1"></a><span class="ot">To</span> <span class="er">correctly</span> <span class="er">estimate</span> <span class="er">standard</span> <span class="er">errors,</span> <span class="er">both</span> <span class="er">steps</span> <span class="er">should</span> <span class="er">be</span> <span class="er">estimated</span> <span class="er">simulatenously,</span> <span class="er">so</span> <span class="er">that</span> <span class="er">the</span> <span class="er">estimation</span> <span class="er">error</span> <span class="er">from</span> <span class="er">the</span> <span class="er">first</span> <span class="er">stage</span> <span class="er">can</span> <span class="er">propagate</span> <span class="er">to</span> <span class="er">the</span> <span class="er">second</span> <span class="er">stage.</span> <span class="er">While</span> <span class="er">you</span> <span class="er">can</span> <span class="er">use</span> <span class="er">`did2s`</span> <span class="er">or</span> <span class="er">`did_imputation`,</span> <span class="er">I</span> <span class="er">will</span> <span class="er">show</span> <span class="er">you</span> <span class="er">the</span> <span class="er">code</span> <span class="er">using</span> <span class="er">`gmm`,</span> <span class="er">so</span> <span class="er">you</span> <span class="er">can</span> <span class="er">see</span> <span class="er">how</span> <span class="er">the</span> <span class="er">whole</span> <span class="er">system</span> <span class="er">would</span> <span class="er">work.</span></span>
<span id="cb37-109"><a href="#cb37-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-110"><a href="#cb37-110" aria-hidden="true" tabindex="-1"></a><span class="ot">In</span> <span class="er">the</span> <span class="er">following</span> <span class="er">code</span> <span class="er">line</span> <span class="er">(1)</span> <span class="er">identifies</span> <span class="er">the</span> <span class="er">individual</span> <span class="er">and</span> <span class="er">time</span> <span class="er">FE</span> <span class="er">using</span> <span class="er">only</span> <span class="er">notyet</span> <span class="er">treated</span> <span class="er">units</span> <span class="er">(trt</span><span class="ot">=</span><span class="st">0).</span> <span class="er">Line</span> <span class="er">2</span> <span class="er">uses</span> <span class="er">tha</span> <span class="er">to</span> <span class="er">substract</span> <span class="er">from</span> <span class="er">$y$</span> <span class="er">and</span> <span class="er">identify</span> <span class="er">the</span> <span class="er">treatment</span> <span class="er">effect</span> <span class="er">(ATT).</span> <span class="er">Lines</span> <span class="er">3</span> <span class="er">and</span> <span class="er">4</span>  <span class="er">provides</span> <span class="er">information</span> <span class="er">to</span> <span class="er">gmm</span> <span class="er">to</span> <span class="er">estimate</span> <span class="er">the</span> <span class="er">model</span> <span class="er">and</span> <span class="er">standard</span> <span class="er">errors:</span></span>
<span id="cb37-111"><a href="#cb37-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-114"><a href="#cb37-114" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb37-115"><a href="#cb37-115" aria-hidden="true" tabindex="-1"></a><span class="ot">gmm</span> <span class="er">((y-{a0}-{a_i:i.g}-{a_t:i.t})*(trt</span><span class="ot">=</span><span class="st">=0))</span>     <span class="er">///</span> </span>
<span id="cb37-116"><a href="#cb37-116" aria-hidden="true" tabindex="-1"></a><span class="ot">    (</span><span class="er">(y-{a0}-{a_i:}</span>   <span class="er">-{a_t:}</span>    <span class="er">-{att:trt}))</span> <span class="er">,</span> <span class="er">///</span> </span>
<span id="cb37-117"><a href="#cb37-117" aria-hidden="true" tabindex="-1"></a><span class="ot">    winitial</span><span class="er">(identity)</span>  <span class="er">instruments(1:i.g</span> <span class="er">i.t)</span> <span class="er">instruments(2:</span> <span class="er">trt)</span> <span class="er">///</span> </span>
<span id="cb37-118"><a href="#cb37-118" aria-hidden="true" tabindex="-1"></a><span class="ot">    onestep</span> <span class="er">quickderivatives</span> <span class="er">vce(cluster</span> <span class="er">i)</span>  </span>
<span id="cb37-119"><a href="#cb37-119" aria-hidden="true" tabindex="-1"></a><span class="er">```</span></span>
<span id="cb37-120"><a href="#cb37-120" aria-hidden="true" tabindex="-1"></a><span class="ot">You</span> <span class="er">can</span> <span class="er">compare</span> <span class="er">this</span> <span class="er">to</span> <span class="er">the</span> <span class="er">true</span> <span class="er">effect:</span></span>
<span id="cb37-123"><a href="#cb37-123" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb37-124"><a href="#cb37-124" aria-hidden="true" tabindex="-1"></a><span class="ot">sum</span> <span class="er">teff</span> <span class="er">if</span> <span class="er">trt</span><span class="ot">=</span><span class="st">=1</span></span>
<span id="cb37-125"><a href="#cb37-125" aria-hidden="true" tabindex="-1"></a><span class="er">```</span></span>
<span id="cb37-126"><a href="#cb37-126" aria-hidden="true" tabindex="-1"></a><span class="ot">One</span> <span class="er">advantage</span> <span class="er">of</span> <span class="er">this</span> <span class="er">approach</span> <span class="er">is</span> <span class="er">that</span> <span class="er">you</span> <span class="er">could</span> <span class="er">model</span> <span class="er">the</span> <span class="er">second</span> <span class="er">stage</span> <span class="er">to</span> <span class="er">allow</span> <span class="er">other</span> <span class="er">types</span> <span class="er">of</span> <span class="er">aggregations:</span></span>
<span id="cb37-127"><a href="#cb37-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-128"><a href="#cb37-128" aria-hidden="true" tabindex="-1"></a><span class="er">```stata</span></span>
<span id="cb37-129"><a href="#cb37-129" aria-hidden="true" tabindex="-1"></a><span class="ot">gen</span> <span class="er">g0</span><span class="ot">=</span><span class="st">g*trt</span>    </span>
<span id="cb37-130"><a href="#cb37-130" aria-hidden="true" tabindex="-1"></a><span class="ot">gen</span> <span class="er">t0</span><span class="ot">=</span><span class="st">t*trt</span></span>
<span id="cb37-131"><a href="#cb37-131" aria-hidden="true" tabindex="-1"></a><span class="ot">gmm</span> <span class="er">((y-{a0}-{a_i:i.g}-{a_t:i.t})*(trt</span><span class="ot">=</span><span class="st">=0))</span> <span class="er">///</span></span>
<span id="cb37-132"><a href="#cb37-132" aria-hidden="true" tabindex="-1"></a><span class="ot">    (</span><span class="er">(y-{a0}-{a_i:}</span>   <span class="er">-{a_t:}</span>    <span class="er">-{att:i.g0}))</span> <span class="er">,</span> <span class="er">///</span></span>
<span id="cb37-133"><a href="#cb37-133" aria-hidden="true" tabindex="-1"></a><span class="ot">    winitial</span><span class="er">(identity)</span>  <span class="er">instruments(1:i.g</span> <span class="er">i.t)</span> <span class="er">instruments(1:</span> <span class="er">i.g0)</span> <span class="er">///</span></span>
<span id="cb37-134"><a href="#cb37-134" aria-hidden="true" tabindex="-1"></a><span class="ot">    onestep</span> <span class="er">quickderivatives</span> <span class="er">vce(cluster</span> <span class="er">i)</span> </span>
<span id="cb37-135"><a href="#cb37-135" aria-hidden="true" tabindex="-1"></a><span class="ot">gmm</span> <span class="er">((y-{a0}-{a_i:i.g}-{a_t:i.t})*(trt</span><span class="ot">=</span><span class="st">=0))</span> <span class="er">///</span></span>
<span id="cb37-136"><a href="#cb37-136" aria-hidden="true" tabindex="-1"></a><span class="ot">    (</span><span class="er">(y-{a0}-{a_i:}</span>   <span class="er">-{a_t:}</span>    <span class="er">-{att:i.t0}))</span> <span class="er">,</span> <span class="er">///</span></span>
<span id="cb37-137"><a href="#cb37-137" aria-hidden="true" tabindex="-1"></a><span class="ot">    winitial</span><span class="er">(identity)</span>  <span class="er">instruments(1:i.g</span> <span class="er">i.t)</span> <span class="er">instruments(2:</span> <span class="er">i.t0)</span> <span class="er">///</span></span>
<span id="cb37-138"><a href="#cb37-138" aria-hidden="true" tabindex="-1"></a><span class="ot">    onestep</span> <span class="er">quickderivatives</span> <span class="er">vce(cluster</span> <span class="er">i)</span>             </span>
<span id="cb37-139"><a href="#cb37-139" aria-hidden="true" tabindex="-1"></a><span class="er">```</span>    </span>
<span id="cb37-140"><a href="#cb37-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-141"><a href="#cb37-141" aria-hidden="true" tabindex="-1"></a><span class="ot">#</span><span class="er">##</span> <span class="er">You</span> <span class="er">don't</span> <span class="er">messup</span> <span class="er">with</span> <span class="er">OLS</span></span>
<span id="cb37-142"><a href="#cb37-142" aria-hidden="true" tabindex="-1"></a><span class="ot">#</span><span class="er">###</span> <span class="er">@wooldridge_twoway_2021</span> <span class="er">`jwdid`</span> <span class="er">and</span> <span class="er">@sun_estimating_2021</span></span>
<span id="cb37-143"><a href="#cb37-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-144"><a href="#cb37-144" aria-hidden="true" tabindex="-1"></a><span class="ot">In</span> <span class="er">the</span> <span class="er">article</span> <span class="er">**DID:</span> <span class="er">the</span> <span class="er">fall**,</span> <span class="er">it</span> <span class="er">was</span> <span class="er">pointed</span> <span class="er">out</span> <span class="er">that</span> <span class="er">the</span> <span class="er">conventional</span> <span class="er">TWFE</span> <span class="er">approach</span> <span class="er">has</span> <span class="er">faced</span> <span class="er">significant</span> <span class="er">backlash</span> <span class="er">due</span> <span class="er">to</span> <span class="er">its</span> <span class="er">limited</span> <span class="er">ability</span> <span class="er">to</span> <span class="er">detect</span> <span class="er">treatment</span> <span class="er">effects,</span> <span class="er">because</span> <span class="er">it</span> <span class="er">cannot</span> <span class="er">distinguish</span> <span class="er">between</span> <span class="er">good</span> <span class="er">and</span> <span class="er">bad</span> <span class="er">variation</span> <span class="er">when</span> <span class="er">estimating</span> <span class="er">treatment</span> <span class="er">effects.</span> <span class="er">Despite</span> <span class="er">this</span> <span class="er">criticism,</span> <span class="er">Professor</span> <span class="er">Wooldridge</span> <span class="er">came</span> <span class="er">in</span> <span class="er">defense</span> <span class="er">and</span> <span class="er">revitalized</span> <span class="er">the</span> <span class="er">approach</span> <span class="er">by</span> <span class="er">emphasizing</span> <span class="er">its</span> <span class="er">simplicity</span> <span class="er">and</span> <span class="er">versatility,</span> <span class="er">enabling</span> <span class="er">extensions</span> <span class="er">to</span> <span class="er">go</span> <span class="er">beyond</span> <span class="er">linear</span> <span class="er">models.</span></span>
<span id="cb37-145"><a href="#cb37-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-146"><a href="#cb37-146" aria-hidden="true" tabindex="-1"></a><span class="ot">The</span> <span class="er">message</span> <span class="er">was</span> <span class="er">simple:</span></span>
<span id="cb37-147"><a href="#cb37-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-148"><a href="#cb37-148" aria-hidden="true" tabindex="-1"></a><span class="kw">&gt;</span> Although the conventional TWFE method has several shortcomings, if it is implemented correctly, it can overcome the issue of utilizing inadequate controls in estimation. As a result, it can estimate treatment effects efficiently, with results similar to @borusyak_revisiting_2022 and @gardner_two-stage_2022.</span>
<span id="cb37-149"><a href="#cb37-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-150"><a href="#cb37-150" aria-hidden="true" tabindex="-1"></a>So what were we missing? Heterogeneity!</span>
<span id="cb37-151"><a href="#cb37-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-152"><a href="#cb37-152" aria-hidden="true" tabindex="-1"></a>Both @wooldridge_twoway_2021 and @sun_estimating_2021 have proposed similar solutions to the problem at hand, albeit from different viewpoints. @sun_estimating_2021 argued that utilizing event studies with leads and lags may lead to contaminated coefficients, thus hampering proper identification of dynamic treatment effects. As a potential solution, the authors suggests using a specification that estimates dynamic effects for each cohort before making aggregations.</span>
<span id="cb37-153"><a href="#cb37-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-154"><a href="#cb37-154" aria-hidden="true" tabindex="-1"></a>On the other hand, @wooldridge_twoway_2021 focused on identifying treatment effects. He recommends allowing all treatment effects to vary by cohort and time. In other words, instead of employing a single dummy variable to identify treated units, he suggests using a set of dummies representing the interaction of cohorts and periods.</span>
<span id="cb37-155"><a href="#cb37-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-156"><a href="#cb37-156" aria-hidden="true" tabindex="-1"></a>Specifically, @wooldridge_twoway_2021 proposes estimating a model with the following specification:</span>
<span id="cb37-157"><a href="#cb37-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-158"><a href="#cb37-158" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-159"><a href="#cb37-159" aria-hidden="true" tabindex="-1"></a>y_{it} = a_i + a_t + \sum_{g=g_0}^G \sum_{t=g}^T \delta_{gt} * 1(g,t)+e_{it}</span>
<span id="cb37-160"><a href="#cb37-160" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-161"><a href="#cb37-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-162"><a href="#cb37-162" aria-hidden="true" tabindex="-1"></a>What Wooldridge suggests, at least for the case without covariates, is to estimate a model where, in addition to the individual (or cohort) and time fixed effects, we saturate **all** possible combinations of cohorts and times ($1(g,t)$), if that combination corresponds to an effectively treated unit ($t\geq g$). This specification essentially uses all not-yet treated units as controls, similar to the two-step approach.</span>
<span id="cb37-163"><a href="#cb37-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-164"><a href="#cb37-164" aria-hidden="true" tabindex="-1"></a>This specification, however, could also be extended to a case where only those never treated are used as controls. In this case, one should use all cohort and time interactions, including the cases before units were treated. Following convention, one should exclude from the list of interactions the period before treatment took place:</span>
<span id="cb37-165"><a href="#cb37-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-166"><a href="#cb37-166" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-167"><a href="#cb37-167" aria-hidden="true" tabindex="-1"></a>y_{it} = a_i + a_t + \sum_{g=g_0}^G \sum_{t\neq g-1} \delta_{gt} * 1(g,t)+e_{it}</span>
<span id="cb37-168"><a href="#cb37-168" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-169"><a href="#cb37-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-170"><a href="#cb37-170" aria-hidden="true" tabindex="-1"></a>By saturating the model this way, each $\delta_{gt}$ represents a treatment effect for group G at time T, which can be later aggregated to obtain dynamic, group, or average treatment effects. Also interesting to note that this second specification is essentially the same @sun_estimating_2021 propose for dynamic effects, and produces results that are identical to the methodology proposed by @callaway_santanna_2021.</span>
<span id="cb37-171"><a href="#cb37-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-172"><a href="#cb37-172" aria-hidden="true" tabindex="-1"></a>Now for the application, I will use <span class="in">`jwdid`</span> for both specifications. Because by default <span class="in">`jwdid`</span> produces the fully saturated model, I will omit those results, showing only the average treatment effect.</span>
<span id="cb37-173"><a href="#cb37-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-174"><a href="#cb37-174" aria-hidden="true" tabindex="-1"></a>First the one using not-yet treated units as controls (default), which produces exactly the same results as the two-step approach:</span>
<span id="cb37-175"><a href="#cb37-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-178"><a href="#cb37-178" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb37-179"><a href="#cb37-179" aria-hidden="true" tabindex="-1"></a><span class="in">*| code-fold: false</span></span>
<span id="cb37-180"><a href="#cb37-180" aria-hidden="true" tabindex="-1"></a><span class="in">ssc install jwdid</span></span>
<span id="cb37-181"><a href="#cb37-181" aria-hidden="true" tabindex="-1"></a><span class="in">qui: jwdid y, ivar(i) tvar(t) gvar(g)</span></span>
<span id="cb37-182"><a href="#cb37-182" aria-hidden="true" tabindex="-1"></a><span class="in">estat simple</span></span>
<span id="cb37-183"><a href="#cb37-183" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-184"><a href="#cb37-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-185"><a href="#cb37-185" aria-hidden="true" tabindex="-1"></a>Second the one with never treated units as controls:</span>
<span id="cb37-186"><a href="#cb37-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-189"><a href="#cb37-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb37-190"><a href="#cb37-190" aria-hidden="true" tabindex="-1"></a><span class="in">*| code-fold: false</span></span>
<span id="cb37-191"><a href="#cb37-191" aria-hidden="true" tabindex="-1"></a><span class="in">qui: jwdid y, ivar(i) tvar(t) gvar(g) never</span></span>
<span id="cb37-192"><a href="#cb37-192" aria-hidden="true" tabindex="-1"></a><span class="in">estat simple</span></span>
<span id="cb37-193"><a href="#cb37-193" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-194"><a href="#cb37-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-195"><a href="#cb37-195" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2x2 in Steroids</span></span>
<span id="cb37-196"><a href="#cb37-196" aria-hidden="true" tabindex="-1"></a><span class="fu">#### @callaway_santanna_2021 `csdid` &amp; `csdid2`</span></span>
<span id="cb37-197"><a href="#cb37-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-198"><a href="#cb37-198" aria-hidden="true" tabindex="-1"></a>The third option is the most computing intensive, but at the same time simpler to understand, if you break it down to the basics. This is why I call this 2x2 in Steroids: @callaway_santanna_2021.</span>
<span id="cb37-199"><a href="#cb37-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-200"><a href="#cb37-200" aria-hidden="true" tabindex="-1"></a>The literature on the 2x2 DID design has been extensively explored and extended, and it appears that most of the criticisms of the TWFE method do not apply to this simple design. Although there are a few technical details to consider while estimating ATT's, most of the information required can be found in @santanna_doubly_2020. In this work, the authors provide several options for obtaining the best estimate from a simple 2x2 DID design.</span>
<span id="cb37-201"><a href="#cb37-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-202"><a href="#cb37-202" aria-hidden="true" tabindex="-1"></a>Assuming that we know how to execute 2x2 DID correctly (which can be achieved using <span class="in">`drdid`</span> in Stata), @callaway_santanna_2021 propose that we focus on estimating all the good and useful 2x2 DID designs from our data while avoiding incorrect comparisons. These are the building blocks of the methodology, the ATTGTs. This are the average treatment effects on the treated for units treated for the first time in period G, but measured at period T.</span>
<span id="cb37-203"><a href="#cb37-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-204"><a href="#cb37-204" aria-hidden="true" tabindex="-1"></a>This process, however, could be time-consuming and computationally intensive if done manually, as the number of 2x2 designs increases with the number of cohorts and periods available in the data. For example, estimating 50 different ATTs would be necessary with 5 cohorts and 10 periods, and up to 5 separate models need to be estimated for each ATT. </span>
<span id="cb37-205"><a href="#cb37-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-206"><a href="#cb37-206" aria-hidden="true" tabindex="-1"></a>Borrowing from the nomenclature in @callaway_santanna_2021, this ATTGT's are defined as follows:</span>
<span id="cb37-207"><a href="#cb37-207" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-208"><a href="#cb37-208" aria-hidden="true" tabindex="-1"></a>\begin{aligned}</span>
<span id="cb37-209"><a href="#cb37-209" aria-hidden="true" tabindex="-1"></a>    ATT(g,t) &amp;= E(Y_{i,t}|i\in g) - E(Y_{i,g-1}|i\in g) <span class="sc">\\</span></span>
<span id="cb37-210"><a href="#cb37-210" aria-hidden="true" tabindex="-1"></a>             &amp; -\Big<span class="co">[</span><span class="ot"> E(Y_{i,t}|i\in C) - E(Y_{i,g-1}|i\in C) \Big</span><span class="co">]</span></span>
<span id="cb37-211"><a href="#cb37-211" aria-hidden="true" tabindex="-1"></a>\end{aligned}</span>
<span id="cb37-212"><a href="#cb37-212" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-213"><a href="#cb37-213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-214"><a href="#cb37-214" aria-hidden="true" tabindex="-1"></a>Which has the same structure as the simple 2x2 DID, with the difference that the control group $C$ will be formed by never treated units only, or include those not yet treated ( $i \in g_i, g_i&gt;t, \And \  g_i&gt;g$).^<span class="co">[</span><span class="ot">There are two other options, but I will leave them for a different post</span><span class="co">]</span></span>
<span id="cb37-215"><a href="#cb37-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-216"><a href="#cb37-216" aria-hidden="true" tabindex="-1"></a>Once all individual ATTGT's have been identified and estimated, providing summary measures we are more familiar with is as easy as obtaining weighted averages:</span>
<span id="cb37-217"><a href="#cb37-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-218"><a href="#cb37-218" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-219"><a href="#cb37-219" aria-hidden="true" tabindex="-1"></a>SATT = \sum \left( \frac{w_{gt} }{\sum w_{gt}}ATT(g,t) \right)</span>
<span id="cb37-220"><a href="#cb37-220" aria-hidden="true" tabindex="-1"></a>$$</span>
<span id="cb37-221"><a href="#cb37-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-222"><a href="#cb37-222" aria-hidden="true" tabindex="-1"></a>where the weights $w_{gt}$ will change based on the type of aggregation one is interested in. </span>
<span id="cb37-223"><a href="#cb37-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-224"><a href="#cb37-224" aria-hidden="true" tabindex="-1"></a>This multiple stage process may seem challening, but there are tools that allow you to implement them quite easily: <span class="in">`csdid`</span> and <span class="in">`csdid2`</span>. </span>
<span id="cb37-225"><a href="#cb37-225" aria-hidden="true" tabindex="-1"></a>The first one, was written as a wrapper around <span class="in">`drdid`</span>, to do all the heavy lifting for you. However, for large projects, it can be slow due to overhead. The alternative <span class="in">`csdid2`</span> is self contained, still under development, but much faster than the predecesor. See <span class="co">[</span><span class="ot">`csdid2`</span><span class="co">](https://github.com/friosavila/csdid2)</span> if interested. Here I will use <span class="in">`csdid`</span>, which you can get from SSC.</span>
<span id="cb37-226"><a href="#cb37-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-227"><a href="#cb37-227" aria-hidden="true" tabindex="-1"></a>As with <span class="in">`jwdid`</span>. The default option is for <span class="in">`csdid`</span> to produce all ATTGT's. So, for the excercise, I'll omit that ouput, and estimate the aggregate effects with the post estimation command. The default is to use the never treated as controls. I will also add the option <span class="in">`long2`</span> to obtain the pre-treatment ATTGT's as describe above, even though they won't affect our point estimates:</span>
<span id="cb37-230"><a href="#cb37-230" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb37-231"><a href="#cb37-231" aria-hidden="true" tabindex="-1"></a><span class="in">*| code-fold: false</span></span>
<span id="cb37-232"><a href="#cb37-232" aria-hidden="true" tabindex="-1"></a><span class="in">qui: ssc install drdid, replace</span></span>
<span id="cb37-233"><a href="#cb37-233" aria-hidden="true" tabindex="-1"></a><span class="in">qui: ssc install csdid, replace</span></span>
<span id="cb37-234"><a href="#cb37-234" aria-hidden="true" tabindex="-1"></a><span class="in">qui: csdid y, ivar(i) time(t) gvar(g) long2</span></span>
<span id="cb37-235"><a href="#cb37-235" aria-hidden="true" tabindex="-1"></a><span class="in">estat simple </span></span>
<span id="cb37-236"><a href="#cb37-236" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-237"><a href="#cb37-237" aria-hidden="true" tabindex="-1"></a>I will also use the not yet treated, to compare results.</span>
<span id="cb37-240"><a href="#cb37-240" aria-hidden="true" tabindex="-1"></a><span class="in">```{stata}</span></span>
<span id="cb37-241"><a href="#cb37-241" aria-hidden="true" tabindex="-1"></a><span class="in">*| code-fold: false</span></span>
<span id="cb37-242"><a href="#cb37-242" aria-hidden="true" tabindex="-1"></a><span class="in">qui: csdid y, ivar(i) time(t) gvar(g) notyet long2</span></span>
<span id="cb37-243"><a href="#cb37-243" aria-hidden="true" tabindex="-1"></a><span class="in">estat simple </span></span>
<span id="cb37-244"><a href="#cb37-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb37-245"><a href="#cb37-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-246"><a href="#cb37-246" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusions</span></span>
<span id="cb37-247"><a href="#cb37-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-248"><a href="#cb37-248" aria-hidden="true" tabindex="-1"></a>On this occasion, I have shared with you three solutions from the literature that aim to overcome the limitations of TWFE. Although there are other solutions available, I personally find these three to be the most intuitive and have worked on them. Granted, I have some bias on the matter.</span>
<span id="cb37-249"><a href="#cb37-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-250"><a href="#cb37-250" aria-hidden="true" tabindex="-1"></a>Despite their apparent differences, these solutions actually converge towards similar outcomes, with discrepancies arising from variations in assumptions regarding control groups or covariate management.</span>
<span id="cb37-251"><a href="#cb37-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-252"><a href="#cb37-252" aria-hidden="true" tabindex="-1"></a>|command | eq command|</span>
<span id="cb37-253"><a href="#cb37-253" aria-hidden="true" tabindex="-1"></a>|---|---|</span>
<span id="cb37-254"><a href="#cb37-254" aria-hidden="true" tabindex="-1"></a>|<span class="in">`jwdid`</span> | <span class="in">`did2s`</span> &amp; <span class="in">`did_imputation`</span>|</span>
<span id="cb37-255"><a href="#cb37-255" aria-hidden="true" tabindex="-1"></a>|<span class="in">`jwdid, never`</span> | <span class="in">`eventstudyinteract`</span>|</span>
<span id="cb37-256"><a href="#cb37-256" aria-hidden="true" tabindex="-1"></a>|<span class="in">`jwdid, never`</span> | <span class="in">`csdid, long2`</span> or <span class="in">`csdid2, long`</span>  |</span>
<span id="cb37-257"><a href="#cb37-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-258"><a href="#cb37-258" aria-hidden="true" tabindex="-1"></a><span class="fu">## References</span></span>
<span id="cb37-259"><a href="#cb37-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-260"><a href="#cb37-260" aria-hidden="true" tabindex="-1"></a>::: {#refs}</span>
<span id="cb37-261"><a href="#cb37-261" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->



</body></html>