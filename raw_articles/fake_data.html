<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="format-detection" content="telephone=no">
<title>Creating Sharable data</title>
<style>
html { -webkit-text-size-adjust: 100%; }
body {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 14px; line-height: 1.428;
  margin: 0 auto; padding: 0 15px;
}
h1, h2, h3, h4, h5, h6 { margin: 20px 0 10px; }
h1 { font-size: 28px; } h2 { font-size: 24px; }
h3 { font-size: 18px; } h4 { font-size: 16px; }
h5 { font-size: 14px; } h6 { font-size: 12px; }
a { color: #337AB7; text-decoration: none; }
a:hover { text-decoration: underline; }
img { max-width: 100%; height: auto; }
ul, ol { padding-left: 30px; }
pre, code, samp {
  font-size: 13px;
  font-family: Courier, monospace;
}
code, samp {
  background-color: #F5F5F5;
  border-radius: 3px; padding: 3px;
}
pre code, pre samp {
  white-space: pre; background: transparent;
  border: none; padding: 0;
}
pre {
  line-height: 1.33; background-color: #F5F5F5;
  border: 1px solid #CCCCCC; border-radius: 3px;
  padding: 8px; overflow: auto;
}
</style>
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script>
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']]
    }
  };
</script>
  <script id="MathJax-script" async
          src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js"></script><style>
.stlog { color: #000000; background-color: #F0F3F9; }
.stres { color: #324F58; }
.stinp { font-weight: bold; color: #000000; }
.stcmd .stcmt { font-style: italic; opacity: 0.5; }
.stoom, .stcnp { font-style: italic; }
@media screen { .stcnp { display: none; }}
</style>
</head>
<body>
<h1>How to come public, with private data</h1>
In a current work with Stephen Jenkins, one problem we face now that we are starting the submission for the publication process is providing a replication package along with the paper.
<br><br>
Providing the code for the model estimations that we created, and even including the Code developed by others authors, is relatively simple. The problem, which many people may face, is how to distribute data that, due to privacy or proprietary reasons, we are not allowed to share. 
<br><br>
As a matter of fact, on this particular project, only Stephen has seen the data, whereas I have worked from the far, primary on the code that estimates the new models (if interest in the research, I'm providing references to previous papers we have worked on below).
<br><br>
So now that is time for the "big" paper to be published, we need some strategy to construct a synthetic dataset that will fulfill all privacy protection constraints, while still transferring the moments' structure that we care about, as well as those we may not be so interested in, but may be of interest for other people.
<br><br>
So, with this idea in mind, I came up with a simple strategy that may help to do just that. An application of Multiple Imputation. This may not be THE best method to do this, so I'll be happy to hear any comments.
<br><br>
To better describe how the method works, I will use one dataset that is readily available online. This data is an excerpt of the Swiss labor market Survey 1998, which is provided as the example dataset in the command -oaxaca- (By Jann 2008).
<h2>The problem </h2>
Assume that you have signed a confidentiality agreement to work with Swiss Survey data. And are ready to submit your work, but you are asked to provide a replication package, with a code to produce the tables you have, and the dataset itself.
<br><br>
Since you cannot share the data, you suggest instead to provide a 5 synthetic synthetic datasets, so people can apply your code, and get to similar (if not the same) conclusions as in your main paper. Here is a piece of code you could use for that.
<pre id="stlog-1" class="stlog"><samp><span class="stinp">. <span class="stcmt">** Assumption. You have a dataset that you want to use</span></span>
<span class="stinp">. clear all</span>

<span class="stinp">. use http://fmwww.bc.edu/RePEc/bocode/o/oaxaca.dta, clear</span>
(Excerpt from the Swiss Labor Market Survey 1998)

<span class="stinp">. misstable summarize</span>
                                                               Obs&lt;.
                                                +------------------------------
               |                                | Unique
      Variable |     Obs=.     Obs&gt;.     Obs&lt;.  | values        Min         Max
  -------------+--------------------------------+------------------------------
        lnwage |<span class="stres">       213</span>          <span class="stres">     1,434</span>  |   &gt;500    .507681    5.259097
         exper |<span class="stres">       213</span>          <span class="stres">     1,434</span>  |   &gt;500          0    49.16667
        tenure |<span class="stres">       213</span>          <span class="stres">     1,434</span>  |    323          0    44.83333
          isco |<span class="stres">       213</span>          <span class="stres">     1,434</span>  |      9          1           9
  -----------------------------------------------------------------------------
</samp></pre>
Four variables have missing data: Wages, tenure, experience, and ISCO,  And they are missing when LFP=0
<br><br>
Now, I suggest creating 1 variable, that will be a "seed" that will be used to recreate synthetic datasets. It will just be a random uniform variable that will range from 0 to 100. And an ID variable.
<pre id="stlog-2" class="stlog"><samp><span class="stinp">. gen id = _n</span>

<span class="stinp">. set seed 10101</span>

<span class="stinp">. gen seed = runiform(0,100)</span>
</samp></pre>
The next step is to decide how large the synthetic dataset will be. The obvious answer is to create a dataset with the same number of observations, but if you want other sample sizes, it could be adjusted. So I'll expand the dataset, duplicating observation 1, 1648 times. I will also tag the original observation:
<pre id="stlog-3" class="stlog"><samp><span class="stinp">. expand 1648 in 1, gen(tag)</span>
(1,647 observations created)
</samp></pre>
You can now set to missing, variables with tag=1
<pre id="stlog-4" class="stlog"><samp><span class="stinp">. foreach i of varlist lnwage educ exper tenure isco female lfp age single married divorced kids6 kids714 wt {</span>
  2<span class="stinp">.         replace `i'=. if tag==1</span>
  3<span class="stinp">. }</span>
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
(1,647 real changes made, 1,647 to missing)
</samp></pre>
And you will need to recreate the "seed" variable as well
<pre id="stlog-5" class="stlog"><samp><span class="stinp">. replace seed = runiform(0,100) if tag==1</span>
(1,647 real changes made)
</samp></pre>
We may also need to set LFP since we have missing data depending on LF status
<pre id="stlog-6" class="stlog"><samp><span class="stinp">. replace lfp = runiform()&lt;.87 if tag==1</span>
(1,647 real changes made)
</samp></pre>
The next step is to create Multiple Imputed datasets. I believe the best strategy here is to use "pmm", because that uses the observed distribution and data types. So first mi set the data, and register all variables to be imputed:
<pre id="stlog-7" class="stlog"><samp><span class="stinp">. mi set wide</span>

<span class="stinp">. mi register impute lnwage educ exper tenure   isco female age single married   kids6 kids714 wt</span>
</samp></pre>
And simply impute all variables using chain pmm. Just make sure none of the variables are collinear (here colinearity exists between single, married, and divorced), and that variables with structural missing data are specified separately.
<br><br>
Notice as well that the explanatory variables are "seed" (fully random) and LFP (also random).
<pre id="stlog-8" class="stlog"><samp><span class="stinp">. mi impute chain (pmm, knn(100))    educ   female   age single married kids6 kids714 wt (pmm if lfp==1, knn(100) ) lnwage  exper tenure isco  = seed lfp, add(5)</span>
note: missing-value pattern is monotone; no iteration performed

Conditional models (monotone):
              <span class="stres">educ</span>: pmm educ seed lfp , knn(100)
            <span class="stres">female</span>: pmm female educ seed lfp , knn(100)
               <span class="stres">age</span>: pmm age female educ seed lfp , knn(100)
            <span class="stres">single</span>: pmm single age female educ seed lfp , knn(100)
           <span class="stres">married</span>: pmm married single age female educ seed lfp , knn(100)
             <span class="stres">kids6</span>: pmm kids6 married single age female educ seed lfp , knn(100)
           <span class="stres">kids714</span>: pmm kids714 kids6 married single age female educ seed lfp , knn(100)
                <span class="stres">wt</span>: pmm wt kids714 kids6 married single age female educ seed lfp , knn(100)
            <span class="stres">lnwage</span>: pmm lnwage wt kids714 kids6 married single age female educ seed lfp if lfp==1, knn(100)
             <span class="stres">exper</span>: pmm exper lnwage wt kids714 kids6 married single age female educ seed lfp if lfp==1, knn(100)
            <span class="stres">tenure</span>: pmm tenure exper lnwage wt kids714 kids6 married single age female educ seed lfp if lfp==1, knn(100)
              <span class="stres">isco</span>: pmm isco tenure exper lnwage wt kids714 kids6 married single age female educ seed lfp if lfp==1, knn(100)

Performing chained iterations ...

Multivariate imputation                     Imputations = <span class="stres">       5</span>
Chained equations                                 added = <span class="stres">       5</span>
Imputed: <i>m</i>=1 through <i>m</i>=5                        updated = <span class="stres">       0</span>

Initialization: <span class="stres">monotone</span>                     Iterations = <span class="stres">       0</span>
                                                burn-in = <span class="stres">       0</span>

              <span class="stres">educ</span>: predictive mean matching
            <span class="stres">female</span>: predictive mean matching
               <span class="stres">age</span>: predictive mean matching
            <span class="stres">single</span>: predictive mean matching
           <span class="stres">married</span>: predictive mean matching
             <span class="stres">kids6</span>: predictive mean matching
           <span class="stres">kids714</span>: predictive mean matching
                <span class="stres">wt</span>: predictive mean matching
            <span class="stres">lnwage</span>: predictive mean matching
             <span class="stres">exper</span>: predictive mean matching
            <span class="stres">tenure</span>: predictive mean matching
              <span class="stres">isco</span>: predictive mean matching

------------------------------------------------------------------
                   |               Observations per <i>m</i>             
                   |----------------------------------------------
          Variable |   Complete   Incomplete   Imputed |     Total
-------------------+-----------------------------------+----------
              educ |<span class="stres">       1647         1647      1647 </span>|<span class="stres">      3294</span>
            female |<span class="stres">       1647         1647      1647 </span>|<span class="stres">      3294</span>
               age |<span class="stres">       1647         1647      1647 </span>|<span class="stres">      3294</span>
            single |<span class="stres">       1647         1647      1647 </span>|<span class="stres">      3294</span>
           married |<span class="stres">       1647         1647      1647 </span>|<span class="stres">      3294</span>
             kids6 |<span class="stres">       1647         1647      1647 </span>|<span class="stres">      3294</span>
           kids714 |<span class="stres">       1647         1647      1647 </span>|<span class="stres">      3294</span>
                wt |<span class="stres">       1647         1647      1647 </span>|<span class="stres">      3294</span>
            lnwage |<span class="stres">       1434         1458      1458 </span>|<span class="stres">      2892</span>
             exper |<span class="stres">       1434         1458      1458 </span>|<span class="stres">      2892</span>
            tenure |<span class="stres">       1434         1458      1458 </span>|<span class="stres">      2892</span>
              isco |<span class="stres">       1434         1458      1458 </span>|<span class="stres">      2892</span>
------------------------------------------------------------------
(complete + incomplete = total; imputed is the minimum across <i>m</i>
 of the number of filled-in observations.)
</samp></pre>
That's it. You have now 5 sets of variables that can be used to create unique synthetic datasets, with a similar structure as the original confidential dataset, and that could be used for replication and public use.
<pre id="stlog-9" class="stlog"><samp><span class="stinp">. forvalues i = 1/5 {</span>
  2<span class="stinp">.         preserve</span>
  3<span class="stinp">.                 keep if tag==1</span>
  4<span class="stinp">.                 keep _`i'_* lfp </span>
  5<span class="stinp">.                 ren _`i'_* *</span>
  6<span class="stinp">.                 save fake_oaxaca_`i', replace</span>
  7<span class="stinp">.         restore</span>
  8<span class="stinp">. }</span>
(1,647 observations deleted)
(note: file fake_oaxaca_1.dta not found)
file fake_oaxaca_1.dta saved
(1,647 observations deleted)
(note: file fake_oaxaca_2.dta not found)
file fake_oaxaca_2.dta saved
(1,647 observations deleted)
(note: file fake_oaxaca_3.dta not found)
file fake_oaxaca_3.dta saved
(1,647 observations deleted)
(note: file fake_oaxaca_4.dta not found)
file fake_oaxaca_4.dta saved
(1,647 observations deleted)
(note: file fake_oaxaca_5.dta not found)
file fake_oaxaca_5.dta saved
</samp></pre>
Now let's see if this works, estimating simple an LR,  CQR model, and a Heckman model.
<pre id="stlog-10" class="stlog"><samp><span class="stinp">. frame create test</span>

<span class="stinp">. </span>
<span class="stinp">. frame test: {</span>
<span class="stinp">.         use http://fmwww.bc.edu/RePEc/bocode/o/oaxaca.dta, clear</span>
(Excerpt from the Swiss Labor Market Survey 1998)
<span class="stinp">.         qui:reg lnwage educ exper tenure female</span>
<span class="stinp">.         est sto m1</span>
<span class="stinp">.         qui:qreg lnwage educ exper tenure female, q(10)</span>
<span class="stinp">.         est sto m2</span>
<span class="stinp">.         qui:heckman lnwage educ exper tenure female age, selec(lfp =educ     female age single married kids6 kids714) two</span>
<span class="stinp">.         est sto m3</span>
<span class="stinp">. }</span>

<span class="stinp">. </span>
<span class="stinp">. forvalues i = 1/5 { </span>
  2<span class="stinp">.         frame test: {</span>
  3<span class="stinp">.                 use fake_oaxaca_`i', clear</span>
  4<span class="stinp">.                 </span>
<span class="stinp">.                 qui:reg lnwage educ exper tenure female</span>
  5<span class="stinp">.                 est sto m1`i'</span>
  6<span class="stinp">.                 qui:qreg lnwage educ exper tenure female, q(10)</span>
  7<span class="stinp">.                 est sto m2`i'</span>
  8<span class="stinp">.  </span>
<span class="stinp">.                 qui:heckman lnwage educ exper tenure female age, selec(lfp =educ     female age single married kids6 kids714) two</span>
  9<span class="stinp">.         est sto m3`i'</span>
 10<span class="stinp">.         } </span>
 11<span class="stinp">. }</span>
(Excerpt from the Swiss Labor Market Survey 1998)
(Excerpt from the Swiss Labor Market Survey 1998)
(Excerpt from the Swiss Labor Market Survey 1998)
(Excerpt from the Swiss Labor Market Survey 1998)
(Excerpt from the Swiss Labor Market Survey 1998)

<span class="stinp">. <span class="stcmt">** OLS</span></span>
<span class="stinp">. esttab m1 m11 m12 m13 m14 m15, mtitle(Original Fake1 Fake2 Fake3 Fake4 Fake5)</span>

------------------------------------------------------------------------------------------------------------
                      (1)             (2)             (3)             (4)             (5)             (6)   
                 Original           Fake1           Fake2           Fake3           Fake4           Fake5   
------------------------------------------------------------------------------------------------------------
educ        <span class="stres">       0.0848***       0.0709***       0.0643***       0.0727***       0.0640***       0.0588***</span>
            <span class="stres">      </span>(<span class="stres">16.34</span>)<span class="stres">         </span>(<span class="stres">14.21</span>)<span class="stres">         </span>(<span class="stres">12.36</span>)<span class="stres">         </span>(<span class="stres">14.67</span>)<span class="stres">         </span>(<span class="stres">13.37</span>)<span class="stres">         </span>(<span class="stres">12.32</span>)<span class="stres">   </span>

exper       <span class="stres">       0.0111***      0.00913***      0.00950***      0.00995***      0.00752***       0.0110***</span>
            <span class="stres">       </span>(<span class="stres">7.22</span>)<span class="stres">          </span>(<span class="stres">6.88</span>)<span class="stres">          </span>(<span class="stres">6.29</span>)<span class="stres">          </span>(<span class="stres">6.76</span>)<span class="stres">          </span>(<span class="stres">5.16</span>)<span class="stres">          </span>(<span class="stres">7.22</span>)<span class="stres">   </span>

tenure      <span class="stres">      0.00771***      0.00570***      0.00718***      0.00644***      0.00670***      0.00540** </span>
            <span class="stres">       </span>(<span class="stres">4.10</span>)<span class="stres">          </span>(<span class="stres">3.41</span>)<span class="stres">          </span>(<span class="stres">3.70</span>)<span class="stres">          </span>(<span class="stres">3.57</span>)<span class="stres">          </span>(<span class="stres">3.75</span>)<span class="stres">          </span>(<span class="stres">2.79</span>)<span class="stres">   </span>

female      <span class="stres">      -0.0841***      -0.0398         -0.1000***      -0.0711**        -0.111***      -0.0767** </span>
            <span class="stres">      </span>(<span class="stres">-3.35</span>)<span class="stres">         </span>(<span class="stres">-1.75</span>)<span class="stres">         </span>(<span class="stres">-3.97</span>)<span class="stres">         </span>(<span class="stres">-2.85</span>)<span class="stres">         </span>(<span class="stres">-4.60</span>)<span class="stres">         </span>(<span class="stres">-3.07</span>)<span class="stres">   </span>

_cons       <span class="stres">        2.213***        2.428***        2.490***        2.373***        2.542***        2.557***</span>
            <span class="stres">      </span>(<span class="stres">32.38</span>)<span class="stres">         </span>(<span class="stres">37.91</span>)<span class="stres">         </span>(<span class="stres">36.03</span>)<span class="stres">         </span>(<span class="stres">35.83</span>)<span class="stres">         </span>(<span class="stres">39.59</span>)<span class="stres">         </span>(<span class="stres">39.51</span>)<span class="stres">   </span>
------------------------------------------------------------------------------------------------------------
N           <span class="stres">         1434            1458            1458            1458            1458            1458   </span>
------------------------------------------------------------------------------------------------------------
t statistics in parentheses
* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001

<span class="stinp">. <span class="stcmt">** qreg 10</span></span>
<span class="stinp">. esttab m2 m21 m22 m23 m24 m25, mtitle(Original Fake1 Fake2 Fake3 Fake4 Fake5)</span>

------------------------------------------------------------------------------------------------------------
                      (1)             (2)             (3)             (4)             (5)             (6)   
                 Original           Fake1           Fake2           Fake3           Fake4           Fake5   
------------------------------------------------------------------------------------------------------------
educ        <span class="stres">        0.103***       0.0679***       0.0738***       0.0881***       0.0703***       0.0735***</span>
            <span class="stres">       </span>(<span class="stres">6.21</span>)<span class="stres">          </span>(<span class="stres">5.48</span>)<span class="stres">          </span>(<span class="stres">5.76</span>)<span class="stres">          </span>(<span class="stres">6.61</span>)<span class="stres">          </span>(<span class="stres">7.69</span>)<span class="stres">          </span>(<span class="stres">5.52</span>)<span class="stres">   </span>

exper       <span class="stres">       0.0200***      0.00867**       0.00944*         0.0147***      0.00769**        0.0196***</span>
            <span class="stres">       </span>(<span class="stres">4.06</span>)<span class="stres">          </span>(<span class="stres">2.63</span>)<span class="stres">          </span>(<span class="stres">2.54</span>)<span class="stres">          </span>(<span class="stres">3.72</span>)<span class="stres">          </span>(<span class="stres">2.76</span>)<span class="stres">          </span>(<span class="stres">4.62</span>)<span class="stres">   </span>

tenure      <span class="stres">     0.000669         0.00326          0.0108*        0.00419         0.00531       -0.000442   </span>
            <span class="stres">       </span>(<span class="stres">0.11</span>)<span class="stres">          </span>(<span class="stres">0.79</span>)<span class="stres">          </span>(<span class="stres">2.26</span>)<span class="stres">          </span>(<span class="stres">0.86</span>)<span class="stres">          </span>(<span class="stres">1.56</span>)<span class="stres">         </span>(<span class="stres">-0.08</span>)<span class="stres">   </span>

female      <span class="stres">       -0.151       -0.000802         -0.0706         -0.0950         -0.0970*        -0.0831   </span>
            <span class="stres">      </span>(<span class="stres">-1.87</span>)<span class="stres">         </span>(<span class="stres">-0.01</span>)<span class="stres">         </span>(<span class="stres">-1.14</span>)<span class="stres">         </span>(<span class="stres">-1.41</span>)<span class="stres">         </span>(<span class="stres">-2.10</span>)<span class="stres">         </span>(<span class="stres">-1.19</span>)<span class="stres">   </span>

_cons       <span class="stres">        1.462***        2.035***        1.869***        1.702***        2.028***        1.866***</span>
            <span class="stres">       </span>(<span class="stres">6.67</span>)<span class="stres">         </span>(<span class="stres">12.81</span>)<span class="stres">         </span>(<span class="stres">10.98</span>)<span class="stres">          </span>(<span class="stres">9.55</span>)<span class="stres">         </span>(<span class="stres">16.55</span>)<span class="stres">         </span>(<span class="stres">10.32</span>)<span class="stres">   </span>
------------------------------------------------------------------------------------------------------------
N           <span class="stres">         1434            1458            1458            1458            1458            1458   </span>
------------------------------------------------------------------------------------------------------------
t statistics in parentheses
* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001

<span class="stinp">. <span class="stcmt">** heckman</span></span>
<span class="stinp">. esttab m3 m31 m32 m33 m34 m35, mtitle(Original Fake1 Fake2 Fake3 Fake4 Fake5)  </span>

------------------------------------------------------------------------------------------------------------
                      (1)             (2)             (3)             (4)             (5)             (6)   
                 Original           Fake1           Fake2           Fake3           Fake4           Fake5   
------------------------------------------------------------------------------------------------------------
<span class="stres">lnwage                                                                                                      </span>
educ        <span class="stres">       0.0717***       0.0677***       0.0575***       0.0701***       0.0594***       0.0534***</span>
            <span class="stres">      </span>(<span class="stres">13.13</span>)<span class="stres">         </span>(<span class="stres">13.02</span>)<span class="stres">         </span>(<span class="stres">10.45</span>)<span class="stres">         </span>(<span class="stres">13.28</span>)<span class="stres">         </span>(<span class="stres">11.91</span>)<span class="stres">         </span>(<span class="stres">10.60</span>)<span class="stres">   </span>

exper       <span class="stres">      0.00179         0.00264         0.00108         0.00271        -0.00226         0.00180   </span>
            <span class="stres">       </span>(<span class="stres">0.94</span>)<span class="stres">          </span>(<span class="stres">1.56</span>)<span class="stres">          </span>(<span class="stres">0.55</span>)<span class="stres">          </span>(<span class="stres">1.51</span>)<span class="stres">         </span>(<span class="stres">-1.28</span>)<span class="stres">          </span>(<span class="stres">0.94</span>)<span class="stres">   </span>

tenure      <span class="stres">      0.00200         0.00199         0.00356         0.00184         0.00144         0.00130   </span>
            <span class="stres">       </span>(<span class="stres">1.01</span>)<span class="stres">          </span>(<span class="stres">1.14</span>)<span class="stres">          </span>(<span class="stres">1.79</span>)<span class="stres">          </span>(<span class="stres">0.98</span>)<span class="stres">          </span>(<span class="stres">0.79</span>)<span class="stres">          </span>(<span class="stres">0.66</span>)<span class="stres">   </span>

female      <span class="stres">       -0.105***      -0.0979**        -0.154***       -0.170***       -0.204***       -0.143***</span>
            <span class="stres">      </span>(<span class="stres">-3.59</span>)<span class="stres">         </span>(<span class="stres">-3.01</span>)<span class="stres">         </span>(<span class="stres">-4.42</span>)<span class="stres">         </span>(<span class="stres">-5.30</span>)<span class="stres">         </span>(<span class="stres">-6.75</span>)<span class="stres">         </span>(<span class="stres">-4.67</span>)<span class="stres">   </span>

age         <span class="stres">       0.0146***      0.00946***       0.0113***       0.0104***       0.0140***       0.0122***</span>
            <span class="stres">       </span>(<span class="stres">7.92</span>)<span class="stres">          </span>(<span class="stres">5.90</span>)<span class="stres">          </span>(<span class="stres">6.56</span>)<span class="stres">          </span>(<span class="stres">6.28</span>)<span class="stres">          </span>(<span class="stres">8.58</span>)<span class="stres">          </span>(<span class="stres">7.16</span>)<span class="stres">   </span>

_cons       <span class="stres">        1.991***        2.220***        2.281***        2.134***        2.230***        2.309***</span>
            <span class="stres">      </span>(<span class="stres">27.12</span>)<span class="stres">         </span>(<span class="stres">30.89</span>)<span class="stres">         </span>(<span class="stres">30.16</span>)<span class="stres">         </span>(<span class="stres">28.82</span>)<span class="stres">         </span>(<span class="stres">31.24</span>)<span class="stres">         </span>(<span class="stres">32.32</span>)<span class="stres">   </span>
------------------------------------------------------------------------------------------------------------
<span class="stres">lfp                                                                                                         </span>
educ        <span class="stres">        0.149***        0.133***        0.156***        0.170***        0.141***        0.160***</span>
            <span class="stres">       </span>(<span class="stres">5.37</span>)<span class="stres">          </span>(<span class="stres">4.93</span>)<span class="stres">          </span>(<span class="stres">6.11</span>)<span class="stres">          </span>(<span class="stres">6.70</span>)<span class="stres">          </span>(<span class="stres">5.59</span>)<span class="stres">          </span>(<span class="stres">6.19</span>)<span class="stres">   </span>

female      <span class="stres">       -1.785***       -1.592***       -1.745***       -1.480***       -1.607***       -1.502***</span>
            <span class="stres">     </span>(<span class="stres">-11.09</span>)<span class="stres">        </span>(<span class="stres">-10.11</span>)<span class="stres">        </span>(<span class="stres">-10.37</span>)<span class="stres">         </span>(<span class="stres">-9.87</span>)<span class="stres">        </span>(<span class="stres">-10.26</span>)<span class="stres">         </span>(<span class="stres">-9.71</span>)<span class="stres">   </span>

age         <span class="stres">      -0.0388***      -0.0214***     -0.00603         -0.0270***      -0.0268***      -0.0252***</span>
            <span class="stres">      </span>(<span class="stres">-5.77</span>)<span class="stres">         </span>(<span class="stres">-4.02</span>)<span class="stres">         </span>(<span class="stres">-1.07</span>)<span class="stres">         </span>(<span class="stres">-4.76</span>)<span class="stres">         </span>(<span class="stres">-4.64</span>)<span class="stres">         </span>(<span class="stres">-4.34</span>)<span class="stres">   </span>

single      <span class="stres">      -0.0998          -0.583**        0.0134          -0.379          -0.483*         -0.159   </span>
            <span class="stres">      </span>(<span class="stres">-0.43</span>)<span class="stres">         </span>(<span class="stres">-3.00</span>)<span class="stres">          </span>(<span class="stres">0.07</span>)<span class="stres">         </span>(<span class="stres">-1.91</span>)<span class="stres">         </span>(<span class="stres">-2.37</span>)<span class="stres">         </span>(<span class="stres">-0.74</span>)<span class="stres">   </span>

married     <span class="stres">       -0.867***       -0.698***       -0.667***       -0.605***       -0.873***       -0.705***</span>
            <span class="stres">      </span>(<span class="stres">-5.48</span>)<span class="stres">         </span>(<span class="stres">-4.14</span>)<span class="stres">         </span>(<span class="stres">-3.97</span>)<span class="stres">         </span>(<span class="stres">-3.89</span>)<span class="stres">         </span>(<span class="stres">-5.13</span>)<span class="stres">         </span>(<span class="stres">-4.48</span>)<span class="stres">   </span>

kids6       <span class="stres">       -0.716***       -0.578***       -0.399***       -0.689***       -0.584***       -0.588***</span>
            <span class="stres">      </span>(<span class="stres">-8.71</span>)<span class="stres">         </span>(<span class="stres">-7.56</span>)<span class="stres">         </span>(<span class="stres">-4.98</span>)<span class="stres">         </span>(<span class="stres">-9.20</span>)<span class="stres">         </span>(<span class="stres">-7.70</span>)<span class="stres">         </span>(<span class="stres">-7.79</span>)<span class="stres">   </span>

kids714     <span class="stres">       -0.343***       -0.131*         -0.177**        -0.282***       -0.206**        -0.207** </span>
            <span class="stres">      </span>(<span class="stres">-5.26</span>)<span class="stres">         </span>(<span class="stres">-2.03</span>)<span class="stres">         </span>(<span class="stres">-2.83</span>)<span class="stres">         </span>(<span class="stres">-4.24</span>)<span class="stres">         </span>(<span class="stres">-3.19</span>)<span class="stres">         </span>(<span class="stres">-3.19</span>)<span class="stres">   </span>

_cons       <span class="stres">        3.543***        2.645***        1.701***        2.438***        2.941***        2.450***</span>
            <span class="stres">       </span>(<span class="stres">7.29</span>)<span class="stres">          </span>(<span class="stres">6.14</span>)<span class="stres">          </span>(<span class="stres">4.11</span>)<span class="stres">          </span>(<span class="stres">5.94</span>)<span class="stres">          </span>(<span class="stres">6.73</span>)<span class="stres">          </span>(<span class="stres">5.66</span>)<span class="stres">   </span>
------------------------------------------------------------------------------------------------------------
<span class="stres">/mills                                                                                                      </span>
lambda      <span class="stres">       -0.123           0.118          0.0737           0.258**         0.218**         0.142   </span>
            <span class="stres">      </span>(<span class="stres">-1.88</span>)<span class="stres">          </span>(<span class="stres">1.43</span>)<span class="stres">          </span>(<span class="stres">0.83</span>)<span class="stres">          </span>(<span class="stres">3.24</span>)<span class="stres">          </span>(<span class="stres">2.94</span>)<span class="stres">          </span>(<span class="stres">1.86</span>)<span class="stres">   </span>
------------------------------------------------------------------------------------------------------------
N           <span class="stres">         1647            1647            1647            1647            1647            1647   </span>
------------------------------------------------------------------------------------------------------------
t statistics in parentheses
* p&lt;0.05, ** p&lt;0.01, *** p&lt;0.001
</samp></pre>
What about covariances:
<pre id="stlog-11" class="stlog"><samp><span class="stinp">. frame test: {</span>
<span class="stinp">.         use http://fmwww.bc.edu/RePEc/bocode/o/oaxaca.dta, clear</span>
(Excerpt from the Swiss Labor Market Survey 1998)
<span class="stinp">.         mean lnwage exper tenure educ   female   age single married kids6 kids714 </span>

Mean estimation                   Number of obs   = <span class="stres">     1,434</span>

--------------------------------------------------------------
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      lnwage |<span class="stres">   3.357604   .0140235      3.330096    3.385113</span>
       exper |<span class="stres">   13.15324   .2632213       12.6369    13.66958</span>
      tenure |<span class="stres">   7.860937   .2144401      7.440287    8.281587</span>
        educ |<span class="stres">   11.53696   .0639585       11.4115    11.66242</span>
      female |<span class="stres">   .4762901   .0131934      .4504096    .5021706</span>
         age |<span class="stres">   38.83891   .2915321      38.26704    39.41079</span>
      single |<span class="stres">   .3891213   .0128794      .3638568    .4143859</span>
     married |<span class="stres">   .4700139   .0131845      .4441509     .495877</span>
       kids6 |<span class="stres">   .2182706   .0151344      .1885826    .2479586</span>
     kids714 |<span class="stres">   .2782427   .0172008      .2445013     .311984</span>
--------------------------------------------------------------
<span class="stinp">. </span>
<span class="stinp">.         corr lnwage exper tenure educ   female   age single married kids6 kids714 , cov</span>
(obs=1,434)

             |   lnwage    exper   tenure     educ   female      age   single  married    kids6  kids714
-------------+------------------------------------------------------------------------------------------
      lnwage |<span class="stres">   .28201</span>
<span class="stres">       </span>exper |<span class="stres">  1.23107  99.3553</span>
<span class="stres">      </span>tenure |<span class="stres">  1.03799  47.0903  65.9418</span>
<span class="stres">        </span>educ |<span class="stres">  .469384 -3.24851 -.510834  5.86604</span>
<span class="stres">      </span>female |<span class="stres"> -.043298 -.484036 -.598583  -.14532  .249612</span>
<span class="stres">         </span>age |<span class="stres">  2.05353  79.3047  54.7529  1.62913  .213554  121.877</span>
<span class="stres">      </span>single |<span class="stres"> -.061535 -1.71735 -1.22853 -.005669 -.001235 -2.87447  .237872</span>
<span class="stres">     </span>married |<span class="stres">  .044889  1.05484  .938517  .089909 -.027229  1.75406  -.18302  .249275</span>
<span class="stres">       </span>kids6 |<span class="stres">  .030479 -.557053 -.447353  .118061 -.034249 -.953649 -.077317  .096222  .328459</span>
<span class="stres">     </span>kids714 |<span class="stres">  .036036  .088118  .006038  .020763  .001368  .469835 -.099274  .100813  .018081  .424272</span>

<span class="stinp">. </span>
<span class="stinp">. }</span>

<span class="stinp">. forvalues i = 1/2 { </span>
  2<span class="stinp">.         frame test: {</span>
  3<span class="stinp">.         use fake_oaxaca_`i', clear</span>
  4<span class="stinp">. mean lnwage exper tenure educ   female   age single married kids6 kids714 </span>
  5<span class="stinp">. </span>
<span class="stinp">.         corr lnwage exper tenure educ   female   age single married kids6 kids714 , cov</span>
  6<span class="stinp">.         } </span>
  7<span class="stinp">. }</span>
(Excerpt from the Swiss Labor Market Survey 1998)

Mean estimation                   Number of obs   = <span class="stres">     1,458</span>

--------------------------------------------------------------
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      lnwage |<span class="stres">   3.388626   .0123486      3.364403    3.412848</span>
       exper |<span class="stres">   13.41598   .2670916      12.89206    13.93991</span>
      tenure |<span class="stres">   7.820988   .2108657      7.407355     8.23462</span>
        educ |<span class="stres">   11.45045   .0597336      11.33327    11.56762</span>
      female |<span class="stres">   .4677641   .0130718      .4421225    .4934056</span>
         age |<span class="stres">   39.12826   .2939283      38.55169    39.70483</span>
      single |<span class="stres">   .3545953   .0125329      .3300108    .3791799</span>
     married |<span class="stres">   .5034294   .0130988      .4777349    .5291238</span>
       kids6 |<span class="stres">   .1920439   .0139977      .1645861    .2195017</span>
     kids714 |<span class="stres">   .3155007   .0185486      .2791158    .3518855</span>
--------------------------------------------------------------
(obs=1,458)

             |   lnwage    exper   tenure     educ   female      age   single  married    kids6  kids714
-------------+------------------------------------------------------------------------------------------
      lnwage |<span class="stres">  .222327</span>
<span class="stres">       </span>exper |<span class="stres">  1.01525  104.011</span>
<span class="stres">      </span>tenure |<span class="stres">  .693356  44.8687   64.829</span>
<span class="stres">        </span>educ |<span class="stres">  .338334 -2.88977 -1.34832  5.20229</span>
<span class="stres">      </span>female |<span class="stres"> -.020663 -.375623 -.251828 -.083016  .249132</span>
<span class="stres">         </span>age |<span class="stres">  1.54067  84.3489  53.0935  .107939  .253623  125.962</span>
<span class="stres">      </span>single |<span class="stres"> -.045191 -1.51045 -1.00048  .021702 -.008122 -2.77303  .229015</span>
<span class="stres">     </span>married |<span class="stres">  .033517  .992395  .849162  .073523  -.01945   1.8242 -.178636   .25016</span>
<span class="stres">       </span>kids6 |<span class="stres">  .015775 -.812525 -.438087   .15314 -.004787 -.966309 -.057163  .076211  .285674</span>
<span class="stres">     </span>kids714 |<span class="stres">  .020063 -.213007 -.197544  .013243 -.000118  .267674  -.08793    .1053 -.006411  .501626</span>

(Excerpt from the Swiss Labor Market Survey 1998)

Mean estimation                   Number of obs   = <span class="stres">     1,458</span>

--------------------------------------------------------------
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
      lnwage |<span class="stres">   3.362503   .0134839      3.336053    3.388953</span>
       exper |<span class="stres">   13.19293   .2599656      12.68298    13.70288</span>
      tenure |<span class="stres">   7.572988   .1992737      7.182094    7.963882</span>
        educ |<span class="stres">   11.51749   .0640525      11.39184    11.64313</span>
      female |<span class="stres">   .4718793   .0130783      .4462249    .4975337</span>
         age |<span class="stres">   38.69342   .2925405      38.11957    39.26726</span>
      single |<span class="stres">   .3909465   .0127837      .3658701    .4160229</span>
     married |<span class="stres">   .4814815   .0130901      .4558041    .5071589</span>
       kids6 |<span class="stres">   .2112483   .0149838      .1818562    .2406404</span>
     kids714 |<span class="stres">    .297668   .0177171      .2629142    .3324218</span>
--------------------------------------------------------------
(obs=1,458)

             |   lnwage    exper   tenure     educ   female      age   single  married    kids6  kids714
-------------+------------------------------------------------------------------------------------------
      lnwage |<span class="stres">  .265087</span>
<span class="stres">       </span>exper |<span class="stres">  .986651  98.5347</span>
<span class="stres">      </span>tenure |<span class="stres">  .758004  40.7152  57.8972</span>
<span class="stres">        </span>educ |<span class="stres">  .346533 -4.37921 -1.28108  5.98176</span>
<span class="stres">      </span>female |<span class="stres"> -.039653 -.398898  -.37838 -.127854   .24938</span>
<span class="stres">         </span>age |<span class="stres">  1.66528  80.5948  46.2706   .23529   .24429  124.776</span>
<span class="stres">      </span>single |<span class="stres">  -.05073 -1.86626 -.965353 -.035669  .010315 -2.92399  .238271</span>
<span class="stres">     </span>married |<span class="stres">  .035125   1.2831  .562809  .104476 -.024886  1.86151 -.188363  .249828</span>
<span class="stres">       </span>kids6 |<span class="stres">  .012868 -.594919 -.426548  .155534 -.031804  -1.0601  -.06823  .085589  .327341</span>
<span class="stres">     </span>kids714 |<span class="stres">  .013946  .323909  -.05909  .070459 -.002605  .382332  -.08488  .109154 -.006645  .457661</span>

</samp></pre>
 <h2>Conclusions</h2>
As you can see, the results are going to be far from perfect replication of the original dataset. After all, we are introducing random errors to create a synthetic dataset, so other people can try to replicate our work.
<br><br>
With those caveats in mind, what we may end up doing is to create synthetic "fake" data like this one, along with two versions of the results. One based on the actual data, and another based on the synthetic dataset(s).
<br><br>
If you are interested in the code I used, you can get it (with Rep Files <a href="fkdata.do">here</a>)
<h2>References</h2>
  Jann, Ben (2008). The Blinder-Oaxaca decomposition for linear regression models. The Stata Journal 8(4): 453-479.
  <br><br>
Jenkins, SP, Rios‚ÄêAvila, F, 2021. "Measurement error in earnings data: replication of Meijer, Rohwedder, and Wansbeek's mixture model approach to combining survey and register data." J Appl Econ. 2021. Accepted Author Manuscript. https://doi.org/10.1002/jae.2811 (with Rep Files <a href="http://qed.econ.queensu.ca/jae/forthcoming/jenkins-rios-avila/">here</a>)
  <br><br>
Jenkins, Stephen P. & Rios-Avila, F, 2020. "Modelling errors in survey and administrative data on employment earnings: Sensitivity to the fraction assumed to have error-free earnings," Economics Letters, Elsevier, vol. 192(C).

</body>
</html>
